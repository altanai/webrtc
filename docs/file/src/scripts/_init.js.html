<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/scripts/_init.js | webrtcdevelopment</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="webrtc based communication and collaboration client. Contains lot of experiments modules "><meta property="twitter:card" content="summary"><meta property="twitter:title" content="webrtcdevelopment"><meta property="twitter:description" content="webrtc based communication and collaboration client. Contains lot of experiments modules "></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/altanai/webrtc"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#scripts">scripts</a><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-CanvasRecorder">CanvasRecorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-GetRecorderType">GetRecorderType</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-GifRecorder">GifRecorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MRecordRTC">MRecordRTC</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MediaStreamRecorder">MediaStreamRecorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-RecordRTC">RecordRTC</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-RecordRTCConfiguration">RecordRTCConfiguration</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-StereoAudioRecorder">StereoAudioRecorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-Whammy">Whammy</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-WhammyRecorder">WhammyRecorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-createFileSharingDiv">createFileSharingDiv</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-_turn.js">_turn.js</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#scripts-rtcconn">scripts/rtcconn</a><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-Whammy">Whammy</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/scripts/_init.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">
/********************************************************************
  global variables
**********************************************************************/

var t = &quot;&quot;;
var e = null;
var n = &quot;&quot;;
var rtcConn ;
var selfuserid=null , remoteUserId=null;
var containerDiv;
var webcallpeers=[];
var sessions = {};
var repeatFlagShowButton =null, repeatFlagHideButton =null, repeatFlagRemoveButton=null ;

/* DOM objects for single user video , user in conf and all other users*/
var localVideo=null, selfVideo=null, remoteVideos=[];

    var RTCPeerConnection = null;
    var webrtcDetectedBrowser = null;
    var webrtcDetectedVersion = null;
    /*var usersList     = document.getElementById(&quot;userslist&quot;);
    var numbersOfUsers  = document.getElementById(&quot;numbersofusers&quot;);
    var usersContainer  = document.getElementById(&quot;usersContainer&quot;);*/
    var tempuserid ;
    var sessions = {};
    var detectRTC ;

    
var selfusername=&quot;&quot; , selfemail=&quot;&quot; , selfcolor=&quot;&quot; ;
var remoteusername=&quot;&quot; , remoteemail=&quot;&quot; , remotecolor=&quot;&quot; ;

var latitude=&quot;&quot; , longitude=&quot;&quot; , operatingsystem=&quot;&quot;;

/* webrtc session intilization */
var autoload = true;
var sessionid = null, socketAddr = &quot;/&quot;, webrtcdevIceServers;
var localStream , localStreamId, remoteStream , remoteStreamId;

/* incoming and outgoing call params */
var incomingAudio =true , incomingVideo =true , incomingData = true;
var outgoingAudio =true , outgoingVideo =true , outgoingData = true;

var debug=false;

var timerobj =false;

var chatobj=false , chatContainer= null;

var fileshareobj=false ;

var screenrecordobj =false ;

var snapshotobj=false ;

var videoRecordobj=false , videoRecordContainer=null;

var drawCanvasobj=false ;

var texteditorobj= false;

var codeeditorobj=false, editor=null;

var reconnectobj=false;

var cursorobj=false;

var muteobj=false;

var minmaxobj=false;

var listeninobj=false;

var screenshareobj=false;

var helpobj=false;

var statisticsobj=false;

var screen, isScreenOn = 0,  chromeMediaSourceId = null , extensioninstalled ;
var screen_roomid , screen_userid;

var role=&quot;participant&quot;;

function init( autoload , callback ){

  if(autoload &amp;&amp; !location.hash.replace(&apos;#&apos;, &apos;&apos;).length) {
    // When Session should autogenerate ssid and locationbar doesnt have a session name
    location.href = location.href.split(&apos;#&apos;)[0] + &apos;#&apos; + (Math.random() * 100).toString().replace(&apos;.&apos;, &apos;&apos;);
    location.reload();
  }else if(autoload &amp;&amp; location.href.replace(&apos;#&apos;, &apos;&apos;).length){
    // When Session should autogenerate ssid and locationbar doesnt have a session name
    if(location.href.indexOf(&apos;?&apos;)&gt;-1){
      sessionid = (location.hash.substring(0,location.hash.indexOf(&apos;?&apos;))).replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g, &apos;&apos;).split(&apos;\n&apos;).join(&apos;&apos;).split(&apos;\r&apos;).join(&apos;&apos;);
    }else{
      sessionid = location.hash.replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g, &apos;&apos;).split(&apos;\n&apos;).join(&apos;&apos;).split(&apos;\r&apos;).join(&apos;&apos;);
    }
    callback(sessionid);

  }else{
    sessionid = prompt(&quot;Enter session &quot;, &quot;&quot;);
    callback(sessionid);
  }
}


function loadjscssfile(filename, filetype){
  if (filetype==&quot;js&quot;){ //if filename is a external JavaScript file
    var fileref=document.createElement(&apos;script&apos;)
    fileref.setAttribute(&quot;type&quot;,&quot;text/javascript&quot;)
    fileref.setAttribute(&quot;src&quot;, filename)
  }
  else if (filetype==&quot;css&quot;){ //if filename is an external CSS file
    var fileref=document.createElement(&quot;link&quot;)
    fileref.setAttribute(&quot;rel&quot;, &quot;stylesheet&quot;)
    fileref.setAttribute(&quot;type&quot;, &quot;text/css&quot;)
    fileref.setAttribute(&quot;href&quot;, filename)
  }
  if (typeof fileref!=&quot;undefined&quot;)
    document.getElementsByTagName(&quot;head&quot;)[0].appendChild(fileref)
}

function loadScript(src, onload) {
  var script = document.createElement(&apos;script&apos;);
  script.src = src;
  script.async = true;
  document.documentElement.appendChild(script);
}

function isData(session) {
  return !session.audio &amp;&amp; !session.video &amp;&amp; !session.screen &amp;&amp; session.data;
}

function isNull(obj) {
  return typeof obj == &apos;undefined&apos;;
}

function isString(obj) {
  return typeof obj == &apos;string&apos;;
}

function isEmpty(session) {
  var length = 0;
  for (var s in session) {
    length++;
  }
  return length == 0;
}

// this method converts array-buffer into string
function ab2str(buf) {
  var result = &apos;&apos;;
  try {
    result = String.fromCharCode.apply(null, new Uint16Array(buf));
  } catch (e) {}
  return result;
}

// this method converts string into array-buffer
function str2ab(str) {
  if (!isString(str)) str = JSON.stringify(str);

  var buf = new ArrayBuffer(str.length * 2); // 2 bytes for each char
  var bufView = new Uint16Array(buf);
  for (var i = 0, strLen = str.length; i &lt; strLen; i++) {
    bufView[i] = str.charCodeAt(i);
  }
  return buf;
}

function toStr(obj) {
  try{
      return JSON.stringify(obj, function(key, value) {
      if (value &amp;&amp; value.sdp) {
        log(value.sdp.type, &apos;\t&apos;, value.sdp.sdp);
        return &apos;&apos;;
      } else return value;
    }, &apos;\t&apos;);
  }catch(e){
    return obj; // in case the obj is non valid json or just a string 
  }
}

function getLength(obj) {
  var length = 0;
  for (var o in obj)
    if (o) length++;
  return length;
}

function getArgsJson(arg){
  var str=&quot;&quot;;
  for (i = 0; i &lt; arg.length; i++) {
    if (arg[i]) {
      str += toStr(arg[i]);
    }
  }
  return str;
}

function isJSON(text){
    if (typeof text!==&quot;string&quot;){
        return false;
    }
    try{
        JSON.parse(text);
        return true;
    }
    catch (error){
        return false;
    }
}

function getElement(e) {
    return document.querySelector(e)
}

function getRandomColor() {
    for (var e = &quot;0123456789ABCDEF&quot;.split(&quot;&quot;), t = &quot;#&quot;, n = 0; 6 &gt; n; n++) t += e[Math.round(15 * Math.random())];
    return t
}

function guid() {
  function s4() {
    return Math.floor((1 + Math.random()) * 0x10000)
      .toString(16)
      .substring(1);
  }
  return s4() + s4() + &apos;-&apos; + s4() + &apos;-&apos; + s4() + &apos;-&apos; +
    s4() + &apos;-&apos; + s4() + s4() + s4();
}


function getUserinfo(e, t) {
    return e ? &apos;&lt;video src=&quot;&apos; + e + &apos;&quot; autoplay&gt;&lt;/vide&gt;&apos; : &apos;&lt;img src=&quot;&apos; + t + &apos;&quot;&gt;&apos;;
}

function fireClickEvent(e) {
    var t = new MouseEvent(&quot;click&quot;, {
        view: window,
        bubbles: !0,
        cancelable: !0
    });
    e.dispatchEvent(t)
}

function bytesToSize(e) {
    var t = [&quot;Bytes&quot;, &quot;KB&quot;, &quot;MB&quot;, &quot;GB&quot;, &quot;TB&quot;];
    if (0 == e) return &quot;0 Bytes&quot;;
    var n = parseInt(Math.floor(Math.log(e) / Math.log(1024)));
    return Math.round(e / Math.pow(1024, n), 2) + &quot; &quot; + t[n]
}

/* ********************************************************
web dev Logger 
****************************************************** */
var webrtcdev = {};
var webrtcdevlogs=[];

webrtcdev.log = function(){
  // var arg = getArgsJson(arguments);
  // document.getElementById(&quot;help-view-body&quot;).innerHTML += &apos;[-]&apos; + arg + &quot;&lt;br/&gt;&quot;;
  if(isJSON(arguments)){
    let arg = JSON.stringify(arguments, undefined, 2);
    webrtcdevlogs.push(&quot;&lt;pre style=&apos;color:grey&apos;&gt;[-]&quot; + arg + &quot;&lt;/pre&gt;&quot;);
  }else{
    let arg = getArgsJson(arguments);
    webrtcdevlogs.push(&quot;&lt;p style=&apos;color:grey&apos;&gt;[-]&quot; + arg + &quot;&lt;/p&gt;&quot;);
  }
  console.log(arguments);
};

webrtcdev.info= function(){
  let arg = getArgsJson(arguments);
  webrtcdevlogs.push(&quot;&lt;p style=&apos;color:blue&apos;&gt;[INFO]&quot; + arg + &quot;&lt;/p&gt;&quot;);
  console.info(arguments);
};

 webrtcdev.debug= function(){
  if(isJSON(arguments)){
    let arg = JSON.stringify(arguments, undefined, 2);
    webrtcdevlogs.push( &quot;&lt;pre style=&apos;color:green&apos;&gt;[DEBUG]&quot; + arg + &quot;&lt;/pre&gt;&quot;);
  }else{
    let arg = getArgsJson(arguments);
    webrtcdevlogs.push(&quot;&lt;p style=&apos;color:green&apos;&gt;[DEBUG]&quot; + arg + &quot;&lt;/p&gt;&quot;);
  }
  console.debug(arguments);
};

webrtcdev.warn= function(){
  let arg = getArgsJson(arguments);
  webrtcdevlogs.push(&quot;&lt;p style=&apos;color:yellow&apos;&gt;[WARN]&quot; + arg + &quot;&lt;/p&gt;&quot;);
  console.warn(arguments);
};

webrtcdev.error= function(){
  let arg = getArgsJson(arguments);
  webrtcdevlogs.push(&quot;&lt;p style=&apos;color:red&apos;&gt;[ERROR]&quot;+ arg + &quot;&lt;/p&gt;&quot;);
  console.error(arguments);
};
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">src/scripts/rtcconn/Plugin.EveryWhere.js | webrtcdevelopment</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="webrtc based communication and collaboration client. Contains lot of experiments modules "><meta property="twitter:card" content="summary"><meta property="twitter:title" content="webrtcdevelopment"><meta property="twitter:description" content="webrtc based communication and collaboration client. Contains lot of experiments modules "></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/altanai/webrtc"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#scripts">scripts</a><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-CanvasRecorder">CanvasRecorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-GetRecorderType">GetRecorderType</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-GifRecorder">GifRecorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MRecordRTC">MRecordRTC</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MediaStreamRecorder">MediaStreamRecorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-RecordRTC">RecordRTC</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-RecordRTCConfiguration">RecordRTCConfiguration</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-StereoAudioRecorder">StereoAudioRecorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-Whammy">Whammy</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-WhammyRecorder">WhammyRecorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-createFileSharingDiv">createFileSharingDiv</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-_turn.js">_turn.js</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#scripts-rtcconn">scripts/rtcconn</a><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-Whammy">Whammy</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/scripts/rtcconn/Plugin.EveryWhere.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">// Last time updated at March 15, 2016

// Latest file can be found here: https://cdn.webrtc-experiment.com/Plugin.EveryWhere.js

// Muaz Khan         - www.MuazKhan.com
// MIT License       - www.WebRTC-Experiment.com/licence
// Source Codes      - https://github.com/muaz-khan/PluginRTC

// _____________________
// Plugin.EveryWhere.js

// Original Source: https://github.com/sarandogou/webrtc-everywhere#downloads

(function() {
    var isSafari = Object.prototype.toString.call(window.HTMLElement).indexOf(&apos;Constructor&apos;) &gt; 0;
    var isEdge = navigator.userAgent.indexOf(&apos;Edge&apos;) !== -1 &amp;&amp; (!!navigator.msSaveOrOpenBlob || !!navigator.msSaveBlob);
    var isIE = !!document.documentMode &amp;&amp; !isEdge;

    var isMobileDevice = !!navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i);

    if (typeof cordova !== &apos;undefined&apos;) {
        isMobileDevice = true;
    }

    if (navigator.userAgent.indexOf(&apos;Crosswalk&apos;) !== -1) {
        isMobileDevice = true;
    }

    if (!(isSafari || isIE) || isMobileDevice) return;

    function LoadPluginRTC() {
        window.PluginRTC = {};

        var extractPluginObj = function(elt) {
            return elt.isWebRtcPlugin ? elt : elt.pluginObj;
        }

        var attachEventListener = function(elt, type, listener, useCapture) {
            var _pluginObj = extractPluginObj(elt);
            if (_pluginObj) {
                _pluginObj.bindEventListener(type, listener, useCapture);
            } else {
                if (typeof elt.addEventListener !== &apos;undefined&apos;) {
                    elt.addEventListener(type, listener, useCapture);
                } else if (typeof elt.addEvent !== &apos;undefined&apos;) {
                    elt.addEventListener(&apos;on&apos; + type, listener, useCapture);
                }
            }
        }

        var pluginUID = &apos;WebrtcEverywherePluginId&apos;;

        function getPlugin() {
            return document.getElementById(pluginUID);
        }

        var installPlugin = function() {
            if (document.getElementById(pluginUID)) {
                return;
            }

            var isInternetExplorer = !!((Object.getOwnPropertyDescriptor &amp;&amp; Object.getOwnPropertyDescriptor(window, &apos;ActiveXObject&apos;)) || (&apos;ActiveXObject&apos; in window));
            var isSafari = !!navigator.userAgent.indexOf(&apos;Safari&apos;);

            var pluginObj = document.createElement(&apos;object&apos;);
            if (isInternetExplorer) {
                pluginObj.setAttribute(&apos;classid&apos;, &apos;CLSID:7FD49E23-C8D7-4C4F-93A1-F7EACFA1EC53&apos;);
                isInternetExplorer = true;
            } else {
                pluginObj.setAttribute(&apos;type&apos;, &apos;application/webrtc-everywhere&apos;);
            }
            pluginObj.setAttribute(&apos;id&apos;, pluginUID);
            document.body.appendChild(pluginObj);
            pluginObj.setAttribute(&apos;width&apos;, &apos;0&apos;);
            pluginObj.setAttribute(&apos;height&apos;, &apos;0&apos;);

            if (pluginObj.isWebRtcPlugin || (typeof navigator.plugins !== &apos;undefined&apos; &amp;&amp; (!!navigator.plugins[&apos;WebRTC Everywhere&apos;] || navigator.plugins[&apos;WebRTC Everywhere Plug-in for Safari&apos;]))) {
                if (isInternetExplorer) {
                    webrtcDetectedBrowser = &apos;Internet Explorer&apos;;
                } else if (isSafari) {
                    webrtcDetectedBrowser = &apos;Safari&apos;;
                }
            }
        }

        if (document.body) {
            installPlugin();
        } else {
            attachEventListener(window, &apos;load&apos;, function() {
                installPlugin();
            });
            attachEventListener(document, &apos;readystatechange&apos;, function() {
                if (document.readyState == &apos;complete&apos;) {
                    installPlugin();
                }
            });
        }

        var getUserMediaDelayed;
        window.PluginRTC.getUserMedia = navigator.getUserMedia = function(constraints, successCallback, errorCallback) {
            if (document.readyState !== &apos;complete&apos;) {
                if (!getUserMediaDelayed) {
                    getUserMediaDelayed = true;
                    attachEventListener(document, &apos;readystatechange&apos;, function() {
                        if (getUserMediaDelayed &amp;&amp; document.readyState == &apos;complete&apos;) {
                            getUserMediaDelayed = false;
                            getPlugin().getUserMedia(constraints, successCallback, errorCallback);
                        }
                    });
                }
            } else {
                getPlugin().getUserMedia(constraints, successCallback, errorCallback);
            }
        }

        window.PluginRTC.attachMediaStream = function(element, stream) {
            if (!element) {
                return null;
            }
            if (element.isWebRtcPlugin) {
                element.src = stream;
                return element;
            } else if (element.nodeName.toLowerCase() === &apos;video&apos;) {
                if (!element.pluginObj &amp;&amp; stream) {
                    var _pluginObj = document.createElement(&apos;object&apos;);
                    var _isIE = (Object.getOwnPropertyDescriptor &amp;&amp; Object.getOwnPropertyDescriptor(window, &apos;ActiveXObject&apos;)) || (&apos;ActiveXObject&apos; in window);
                    if (_isIE) {
                        // windowless
                        var windowlessParam = document.createElement(&apos;param&apos;);
                        windowlessParam.setAttribute(&apos;name&apos;, &apos;windowless&apos;);
                        windowlessParam.setAttribute(&apos;value&apos;, true);
                        _pluginObj.appendChild(windowlessParam);
                        _pluginObj.setAttribute(&apos;classid&apos;, &apos;CLSID:7FD49E23-C8D7-4C4F-93A1-F7EACFA1EC53&apos;);
                    } else {
                        _pluginObj.setAttribute(&apos;type&apos;, &apos;application/webrtc-everywhere&apos;);
                    }
                    element.pluginObj = _pluginObj;

                    _pluginObj.setAttribute(&apos;className&apos;, element.className);
                    _pluginObj.setAttribute(&apos;innerHTML&apos;, element.innerHTML);
                    var width = element.getAttribute(&apos;width&apos;);
                    var height = element.getAttribute(&apos;height&apos;);
                    var bounds = element.getBoundingClientRect();
                    if (!width) width = bounds.right - bounds.left;
                    if (!height) height = bounds.bottom - bounds.top;

                    if (&apos;getComputedStyle&apos; in window) {
                        var computedStyle = window.getComputedStyle(element, null);
                        if (!width &amp;&amp; computedStyle.width != &apos;auto&apos; &amp;&amp; computedStyle.width != &apos;0px&apos;) {
                            width = computedStyle.width;
                        }
                        if (!height &amp;&amp; computedStyle.height != &apos;auto&apos; &amp;&amp; computedStyle.height != &apos;0px&apos;) {
                            height = computedStyle.height;
                        }
                    }
                    if (width) _pluginObj.setAttribute(&apos;width&apos;, width);
                    else _pluginObj.setAttribute(&apos;autowidth&apos;, true);
                    if (height) _pluginObj.setAttribute(&apos;height&apos;, height);
                    else _pluginObj.setAttribute(&apos;autoheight&apos;, true);

                    document.body.appendChild(_pluginObj);
                    if (element.parentNode) {
                        element.parentNode.replaceChild(_pluginObj, element); // replace (and remove) element
                        // add element again to be sure any query() will succeed
                        document.body.appendChild(element);
                        element.style.visibility = &apos;hidden&apos;;
                    }
                }

                if (element.pluginObj) {
                    element.pluginObj.bindEventListener(&apos;play&apos;, function(objvid) {
                        if (element.pluginObj) {
                            if (element.pluginObj.getAttribute(&apos;autowidth&apos;) &amp;&amp; objvid.videoWidth) {
                                element.pluginObj.setAttribute(&apos;width&apos;, objvid.videoWidth /* + &apos;px&apos;*/ );
                            }
                            if (element.pluginObj.getAttribute(&apos;autoheight&apos;) &amp;&amp; objvid.videoHeight) {
                                element.pluginObj.setAttribute(&apos;height&apos;, objvid.videoHeight /* + &apos;px&apos;*/ );
                            }
                        }
                    });
                    element.pluginObj.src = stream;
                }

                return element.pluginObj;
            } else if (element.nodeName.toLowerCase() === &apos;audio&apos;) {
                return element;
            }
        };

        window.PluginRTC.MediaStreamTrack = {};
        var getSourcesDelayed;
        window.PluginRTC.MediaStreamTrack.getSources = function(gotSources) {
            if (document.readyState !== &apos;complete&apos;) {
                if (!getSourcesDelayed) {
                    getSourcesDelayed = true;
                    attachEventListener(document, &apos;readystatechange&apos;, function() {
                        if (getSourcesDelayed &amp;&amp; document.readyState == &apos;complete&apos;) {
                            getSourcesDelayed = false;
                            getPlugin().getSources(gotSources);
                        }
                    });
                }
            } else {
                getPlugin().getSources(gotSources);
            }
        }

        window.PluginRTC.RTCPeerConnection = function(configuration, constraints) {
            return getPlugin().createPeerConnection(configuration, constraints);
        }

        window.PluginRTC.RTCIceCandidate = function(RTCIceCandidateInit) {
            return getPlugin().createIceCandidate(RTCIceCandidateInit);
        }

        window.PluginRTC.RTCSessionDescription = function(RTCSessionDescriptionInit) {
            return getPlugin().createSessionDescription(RTCSessionDescriptionInit);
        }

        if (window.onPluginRTCInitialized) {
            window.onPluginRTCInitialized(window.PluginRTC);
        }
    }

    window.addEventListener(&apos;load&apos;, LoadPluginRTC, false);
})();
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>

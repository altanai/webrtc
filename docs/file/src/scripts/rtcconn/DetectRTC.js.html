<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">src/scripts/rtcconn/DetectRTC.js | webrtcdevelopment</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="webrtc based communication and collaboration client. Contains lot of experiments modules "><meta property="twitter:card" content="summary"><meta property="twitter:title" content="webrtcdevelopment"><meta property="twitter:description" content="webrtc based communication and collaboration client. Contains lot of experiments modules "></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/altanai/webrtc"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#scripts">scripts</a><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-CanvasRecorder">CanvasRecorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-GetRecorderType">GetRecorderType</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-GifRecorder">GifRecorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MRecordRTC">MRecordRTC</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MediaStreamRecorder">MediaStreamRecorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-RecordRTC">RecordRTC</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-RecordRTCConfiguration">RecordRTCConfiguration</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-StereoAudioRecorder">StereoAudioRecorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-Whammy">Whammy</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-WhammyRecorder">WhammyRecorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-createFileSharingDiv">createFileSharingDiv</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-_turn.js">_turn.js</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#scripts-rtcconn">scripts/rtcconn</a><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-Whammy">Whammy</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/scripts/rtcconn/DetectRTC.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">&apos;use strict&apos;;

// Last Updated On: 2018-05-05 12:25:07 PM UTC

// ________________
// DetectRTC v1.3.6

// Open-Sourced: https://github.com/muaz-khan/DetectRTC

// --------------------------------------------------
// Muaz Khan     - www.MuazKhan.com
// MIT License   - www.WebRTC-Experiment.com/licence
// --------------------------------------------------

(function() {

    var browserFakeUserAgent = &apos;Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45&apos;;

    var isNodejs = typeof process === &apos;object&apos; &amp;&amp; typeof process.versions === &apos;object&apos; &amp;&amp; process.versions.node &amp;&amp; /*node-process*/ !process.browser;
    if (isNodejs) {
        var version = process.versions.node.toString().replace(&apos;v&apos;, &apos;&apos;);
        browserFakeUserAgent = &apos;Nodejs/&apos; + version + &apos; (NodeOS) AppleWebKit/&apos; + version + &apos; (KHTML, like Gecko) Nodejs/&apos; + version + &apos; Nodejs/&apos; + version
    }

    (function(that) {
        if (typeof window !== &apos;undefined&apos;) {
            return;
        }

        if (typeof window === &apos;undefined&apos; &amp;&amp; typeof global !== &apos;undefined&apos;) {
            global.navigator = {
                userAgent: browserFakeUserAgent,
                getUserMedia: function() {}
            };

            /*global window:true */
            that.window = global;
        } else if (typeof window === &apos;undefined&apos;) {
            // window = this;
        }

        if (typeof location === &apos;undefined&apos;) {
            /*global location:true */
            that.location = {
                protocol: &apos;file:&apos;,
                href: &apos;&apos;,
                hash: &apos;&apos;
            };
        }

        if (typeof screen === &apos;undefined&apos;) {
            /*global screen:true */
            that.screen = {
                width: 0,
                height: 0
            };
        }
    })(typeof global !== &apos;undefined&apos; ? global : window);

    /*global navigator:true */
    var navigator = window.navigator;

    if (typeof navigator !== &apos;undefined&apos;) {
        if (typeof navigator.webkitGetUserMedia !== &apos;undefined&apos;) {
            navigator.getUserMedia = navigator.webkitGetUserMedia;
        }

        if (typeof navigator.mozGetUserMedia !== &apos;undefined&apos;) {
            navigator.getUserMedia = navigator.mozGetUserMedia;
        }
    } else {
        navigator = {
            getUserMedia: function() {},
            userAgent: browserFakeUserAgent
        };
    }

    var isMobileDevice = !!(/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(navigator.userAgent || &apos;&apos;));

    var isEdge = navigator.userAgent.indexOf(&apos;Edge&apos;) !== -1 &amp;&amp; (!!navigator.msSaveOrOpenBlob || !!navigator.msSaveBlob);

    var isOpera = !!window.opera || navigator.userAgent.indexOf(&apos; OPR/&apos;) &gt;= 0;
    var isFirefox = typeof window.InstallTrigger !== &apos;undefined&apos;;
    var isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
    var isChrome = !!window.chrome &amp;&amp; !isOpera;
    var isIE = typeof document !== &apos;undefined&apos; &amp;&amp; !!document.documentMode &amp;&amp; !isEdge;

    // this one can also be used:
    // https://www.websocket.org/js/stuff.js (DetectBrowser.js)

    function getBrowserInfo() {
        var nVer = navigator.appVersion;
        var nAgt = navigator.userAgent;
        var browserName = navigator.appName;
        var fullVersion = &apos;&apos; + parseFloat(navigator.appVersion);
        var majorVersion = parseInt(navigator.appVersion, 10);
        var nameOffset, verOffset, ix;

        // In Opera, the true version is after &apos;Opera&apos; or after &apos;Version&apos;
        if (isOpera) {
            browserName = &apos;Opera&apos;;
            try {
                fullVersion = navigator.userAgent.split(&apos;OPR/&apos;)[1].split(&apos; &apos;)[0];
                majorVersion = fullVersion.split(&apos;.&apos;)[0];
            } catch (e) {
                fullVersion = &apos;0.0.0.0&apos;;
                majorVersion = 0;
            }
        }
        // In MSIE version &lt;=10, the true version is after &apos;MSIE&apos; in userAgent
        // In IE 11, look for the string after &apos;rv:&apos;
        else if (isIE) {
            verOffset = nAgt.indexOf(&apos;rv:&apos;);
            if (verOffset &gt; 0) { //IE 11
                fullVersion = nAgt.substring(verOffset + 3);
            } else { //IE 10 or earlier
                verOffset = nAgt.indexOf(&apos;MSIE&apos;);
                fullVersion = nAgt.substring(verOffset + 5);
            }
            browserName = &apos;IE&apos;;
        }
        // In Chrome, the true version is after &apos;Chrome&apos; 
        else if (isChrome) {
            verOffset = nAgt.indexOf(&apos;Chrome&apos;);
            browserName = &apos;Chrome&apos;;
            fullVersion = nAgt.substring(verOffset + 7);
        }
        // In Safari, the true version is after &apos;Safari&apos; or after &apos;Version&apos; 
        else if (isSafari) {
            verOffset = nAgt.indexOf(&apos;Safari&apos;);

            browserName = &apos;Safari&apos;;
            fullVersion = nAgt.substring(verOffset + 7);

            if ((verOffset = nAgt.indexOf(&apos;Version&apos;)) !== -1) {
                fullVersion = nAgt.substring(verOffset + 8);
            }

            if (navigator.userAgent.indexOf(&apos;Version/&apos;) !== -1) {
                fullVersion = navigator.userAgent.split(&apos;Version/&apos;)[1].split(&apos; &apos;)[0];
            }
        }
        // In Firefox, the true version is after &apos;Firefox&apos; 
        else if (isFirefox) {
            verOffset = nAgt.indexOf(&apos;Firefox&apos;);
            browserName = &apos;Firefox&apos;;
            fullVersion = nAgt.substring(verOffset + 8);
        }

        // In most other browsers, &apos;name/version&apos; is at the end of userAgent 
        else if ((nameOffset = nAgt.lastIndexOf(&apos; &apos;) + 1) &lt; (verOffset = nAgt.lastIndexOf(&apos;/&apos;))) {
            browserName = nAgt.substring(nameOffset, verOffset);
            fullVersion = nAgt.substring(verOffset + 1);

            if (browserName.toLowerCase() === browserName.toUpperCase()) {
                browserName = navigator.appName;
            }
        }

        if (isEdge) {
            browserName = &apos;Edge&apos;;
            fullVersion = navigator.userAgent.split(&apos;Edge/&apos;)[1];
            // fullVersion = parseInt(navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)[2], 10).toString();
        }

        // trim the fullVersion string at semicolon/space/bracket if present
        if ((ix = fullVersion.search(/[; \)]/)) !== -1) {
            fullVersion = fullVersion.substring(0, ix);
        }

        majorVersion = parseInt(&apos;&apos; + fullVersion, 10);

        if (isNaN(majorVersion)) {
            fullVersion = &apos;&apos; + parseFloat(navigator.appVersion);
            majorVersion = parseInt(navigator.appVersion, 10);
        }

        return {
            fullVersion: fullVersion,
            version: majorVersion,
            name: browserName,
            isPrivateBrowsing: false
        };
    }

    // via: https://gist.github.com/cou929/7973956

    function retry(isDone, next) {
        var currentTrial = 0,
            maxRetry = 50,
            interval = 10,
            isTimeout = false;
        var id = window.setInterval(
            function() {
                if (isDone()) {
                    window.clearInterval(id);
                    next(isTimeout);
                }
                if (currentTrial++ &gt; maxRetry) {
                    window.clearInterval(id);
                    isTimeout = true;
                    next(isTimeout);
                }
            },
            10
        );
    }

    function isIE10OrLater(userAgent) {
        var ua = userAgent.toLowerCase();
        if (ua.indexOf(&apos;msie&apos;) === 0 &amp;&amp; ua.indexOf(&apos;trident&apos;) === 0) {
            return false;
        }
        var match = /(?:msie|rv:)\s?([\d\.]+)/.exec(ua);
        if (match &amp;&amp; parseInt(match[1], 10) &gt;= 10) {
            return true;
        }
        return false;
    }

    function detectPrivateMode(callback) {
        var isPrivate;

        try {

            if (window.webkitRequestFileSystem) {
                window.webkitRequestFileSystem(
                    window.TEMPORARY, 1,
                    function() {
                        isPrivate = false;
                    },
                    function(e) {
                        isPrivate = true;
                    }
                );
            } else if (window.indexedDB &amp;&amp; /Firefox/.test(window.navigator.userAgent)) {
                var db;
                try {
                    db = window.indexedDB.open(&apos;test&apos;);
                    db.onerror = function() {
                        return true;
                    };
                } catch (e) {
                    isPrivate = true;
                }

                if (typeof isPrivate === &apos;undefined&apos;) {
                    retry(
                        function isDone() {
                            return db.readyState === &apos;done&apos; ? true : false;
                        },
                        function next(isTimeout) {
                            if (!isTimeout) {
                                isPrivate = db.result ? false : true;
                            }
                        }
                    );
                }
            } else if (isIE10OrLater(window.navigator.userAgent)) {
                isPrivate = false;
                try {
                    if (!window.indexedDB) {
                        isPrivate = true;
                    }
                } catch (e) {
                    isPrivate = true;
                }
            } else if (window.localStorage &amp;&amp; /Safari/.test(window.navigator.userAgent)) {
                try {
                    window.localStorage.setItem(&apos;test&apos;, 1);
                } catch (e) {
                    isPrivate = true;
                }

                if (typeof isPrivate === &apos;undefined&apos;) {
                    isPrivate = false;
                    window.localStorage.removeItem(&apos;test&apos;);
                }
            }

        } catch (e) {
            isPrivate = false;
        }

        retry(
            function isDone() {
                return typeof isPrivate !== &apos;undefined&apos; ? true : false;
            },
            function next(isTimeout) {
                callback(isPrivate);
            }
        );
    }

    var isMobile = {
        Android: function() {
            return navigator.userAgent.match(/Android/i);
        },
        BlackBerry: function() {
            return navigator.userAgent.match(/BlackBerry|BB10/i);
        },
        iOS: function() {
            return navigator.userAgent.match(/iPhone|iPad|iPod/i);
        },
        Opera: function() {
            return navigator.userAgent.match(/Opera Mini/i);
        },
        Windows: function() {
            return navigator.userAgent.match(/IEMobile/i);
        },
        any: function() {
            return (isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows());
        },
        getOsName: function() {
            var osName = &apos;Unknown OS&apos;;
            if (isMobile.Android()) {
                osName = &apos;Android&apos;;
            }

            if (isMobile.BlackBerry()) {
                osName = &apos;BlackBerry&apos;;
            }

            if (isMobile.iOS()) {
                osName = &apos;iOS&apos;;
            }

            if (isMobile.Opera()) {
                osName = &apos;Opera Mini&apos;;
            }

            if (isMobile.Windows()) {
                osName = &apos;Windows&apos;;
            }

            return osName;
        }
    };

    // via: http://jsfiddle.net/ChristianL/AVyND/
    function detectDesktopOS() {
        var unknown = &apos;-&apos;;

        var nVer = navigator.appVersion;
        var nAgt = navigator.userAgent;

        var os = unknown;
        var clientStrings = [{
            s: &apos;Windows 10&apos;,
            r: /(Windows 10.0|Windows NT 10.0)/
        }, {
            s: &apos;Windows 8.1&apos;,
            r: /(Windows 8.1|Windows NT 6.3)/
        }, {
            s: &apos;Windows 8&apos;,
            r: /(Windows 8|Windows NT 6.2)/
        }, {
            s: &apos;Windows 7&apos;,
            r: /(Windows 7|Windows NT 6.1)/
        }, {
            s: &apos;Windows Vista&apos;,
            r: /Windows NT 6.0/
        }, {
            s: &apos;Windows Server 2003&apos;,
            r: /Windows NT 5.2/
        }, {
            s: &apos;Windows XP&apos;,
            r: /(Windows NT 5.1|Windows XP)/
        }, {
            s: &apos;Windows 2000&apos;,
            r: /(Windows NT 5.0|Windows 2000)/
        }, {
            s: &apos;Windows ME&apos;,
            r: /(Win 9x 4.90|Windows ME)/
        }, {
            s: &apos;Windows 98&apos;,
            r: /(Windows 98|Win98)/
        }, {
            s: &apos;Windows 95&apos;,
            r: /(Windows 95|Win95|Windows_95)/
        }, {
            s: &apos;Windows NT 4.0&apos;,
            r: /(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/
        }, {
            s: &apos;Windows CE&apos;,
            r: /Windows CE/
        }, {
            s: &apos;Windows 3.11&apos;,
            r: /Win16/
        }, {
            s: &apos;Android&apos;,
            r: /Android/
        }, {
            s: &apos;Open BSD&apos;,
            r: /OpenBSD/
        }, {
            s: &apos;Sun OS&apos;,
            r: /SunOS/
        }, {
            s: &apos;Linux&apos;,
            r: /(Linux|X11)/
        }, {
            s: &apos;iOS&apos;,
            r: /(iPhone|iPad|iPod)/
        }, {
            s: &apos;Mac OS X&apos;,
            r: /Mac OS X/
        }, {
            s: &apos;Mac OS&apos;,
            r: /(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/
        }, {
            s: &apos;QNX&apos;,
            r: /QNX/
        }, {
            s: &apos;UNIX&apos;,
            r: /UNIX/
        }, {
            s: &apos;BeOS&apos;,
            r: /BeOS/
        }, {
            s: &apos;OS/2&apos;,
            r: /OS\/2/
        }, {
            s: &apos;Search Bot&apos;,
            r: /(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/
        }];
        for (var i = 0, cs; cs = clientStrings[i]; i++) {
            if (cs.r.test(nAgt)) {
                os = cs.s;
                break;
            }
        }

        var osVersion = unknown;

        if (/Windows/.test(os)) {
            if (/Windows (.*)/.test(os)) {
                osVersion = /Windows (.*)/.exec(os)[1];
            }
            os = &apos;Windows&apos;;
        }

        switch (os) {
            case &apos;Mac OS X&apos;:
                if (/Mac OS X (10[\.\_\d]+)/.test(nAgt)) {
                    osVersion = /Mac OS X (10[\.\_\d]+)/.exec(nAgt)[1];
                }
                break;
            case &apos;Android&apos;:
                if (/Android ([\.\_\d]+)/.test(nAgt)) {
                    osVersion = /Android ([\.\_\d]+)/.exec(nAgt)[1];
                }
                break;
            case &apos;iOS&apos;:
                if (/OS (\d+)_(\d+)_?(\d+)?/.test(nAgt)) {
                    osVersion = /OS (\d+)_(\d+)_?(\d+)?/.exec(nVer);
                    osVersion = osVersion[1] + &apos;.&apos; + osVersion[2] + &apos;.&apos; + (osVersion[3] | 0);
                }
                break;
        }

        return {
            osName: os,
            osVersion: osVersion
        };
    }

    var osName = &apos;Unknown OS&apos;;
    var osVersion = &apos;Unknown OS Version&apos;;

    function getAndroidVersion(ua) {
        ua = (ua || navigator.userAgent).toLowerCase();
        var match = ua.match(/android\s([0-9\.]*)/);
        return match ? match[1] : false;
    }

    var osInfo = detectDesktopOS();

    if (osInfo &amp;&amp; osInfo.osName &amp;&amp; osInfo.osName != &apos;-&apos;) {
        osName = osInfo.osName;
        osVersion = osInfo.osVersion;
    } else if (isMobile.any()) {
        osName = isMobile.getOsName();

        if (osName == &apos;Android&apos;) {
            osVersion = getAndroidVersion();
        }
    }

    var isNodejs = typeof process === &apos;object&apos; &amp;&amp; typeof process.versions === &apos;object&apos; &amp;&amp; process.versions.node;

    if (osName === &apos;Unknown OS&apos; &amp;&amp; isNodejs) {
        osName = &apos;Nodejs&apos;;
        osVersion = process.versions.node.toString().replace(&apos;v&apos;, &apos;&apos;);
    }

    var isCanvasSupportsStreamCapturing = false;
    var isVideoSupportsStreamCapturing = false;
    [&apos;captureStream&apos;, &apos;mozCaptureStream&apos;, &apos;webkitCaptureStream&apos;].forEach(function(item) {
        if (typeof document === &apos;undefined&apos; || typeof document.createElement !== &apos;function&apos;) {
            return;
        }

        if (!isCanvasSupportsStreamCapturing &amp;&amp; item in document.createElement(&apos;canvas&apos;)) {
            isCanvasSupportsStreamCapturing = true;
        }

        if (!isVideoSupportsStreamCapturing &amp;&amp; item in document.createElement(&apos;video&apos;)) {
            isVideoSupportsStreamCapturing = true;
        }
    });

    // via: https://github.com/diafygi/webrtc-ips
    function DetectLocalIPAddress(callback, stream) {
        if (!DetectRTC.isWebRTCSupported) {
            return;
        }

        getIPs(function(ip) {
            if (ip.match(/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/)) {
                callback(&apos;Local: &apos; + ip);
            } else {
                callback(&apos;Public: &apos; + ip);
            }
        }, stream);
    }

    function getIPs(callback, stream) {
        if (typeof document === &apos;undefined&apos; || typeof document.getElementById !== &apos;function&apos;) {
            return;
        }

        var ipDuplicates = {};

        var RTCPeerConnection = window.RTCPeerConnection || window.mozRTCPeerConnection || window.webkitRTCPeerConnection;

        if (!RTCPeerConnection) {
            var iframe = document.getElementById(&apos;iframe&apos;);
            if (!iframe) {
                return;
            }
            var win = iframe.contentWindow;
            RTCPeerConnection = win.RTCPeerConnection || win.mozRTCPeerConnection || win.webkitRTCPeerConnection;
        }

        if (!RTCPeerConnection) {
            return;
        }

        var peerConfig = null;

        if (DetectRTC.browser === &apos;Chrome&apos; &amp;&amp; DetectRTC.browser.version &lt; 58) {
            // todo: add support for older Opera
            peerConfig = {
                optional: [{
                    RtpDataChannels: true
                }]
            };
        }

        var servers = {
            iceServers: [{
                urls: &apos;stun:stun.l.google.com:19302&apos;
            }]
        };

        var pc = new RTCPeerConnection(servers, peerConfig);

        if (stream) {
            if (pc.addStream) {
                pc.addStream(stream);
            } else if (pc.addTrack &amp;&amp; stream.getTracks()[0]) {
                pc.addTrack(stream.getTracks()[0], stream);
            }
        }

        function handleCandidate(candidate) {
            var ipRegex = /([0-9]{1,3}(\.[0-9]{1,3}){3})/;
            var match = ipRegex.exec(candidate);
            if (!match) {
                return;
            }
            var ipAddress = match[1];

            if (ipDuplicates[ipAddress] === undefined) {
                callback(ipAddress);
            }

            ipDuplicates[ipAddress] = true;
        }

        // listen for candidate events
        pc.onicecandidate = function(ice) {
            if (ice.candidate) {
                handleCandidate(ice.candidate.candidate);
            }
        };

        // create data channel
        if (!stream) {
            try {
                pc.createDataChannel(&apos;sctp&apos;, {});
            } catch (e) {}
        }

        // create an offer sdp
        if (DetectRTC.isPromisesSupported) {
            pc.createOffer().then(function(result) {
                pc.setLocalDescription(result).then(afterCreateOffer);
            });
        } else {
            pc.createOffer(function(result) {
                pc.setLocalDescription(result, afterCreateOffer, function() {});
            }, function() {});
        }

        function afterCreateOffer() {
            var lines = pc.localDescription.sdp.split(&apos;\n&apos;);

            lines.forEach(function(line) {
                if (line.indexOf(&apos;a=candidate:&apos;) === 0) {
                    handleCandidate(line);
                }
            });
        }
    }

    var MediaDevices = [];

    var audioInputDevices = [];
    var audioOutputDevices = [];
    var videoInputDevices = [];

    if (navigator.mediaDevices &amp;&amp; navigator.mediaDevices.enumerateDevices) {
        // Firefox 38+ seems having support of enumerateDevices
        // Thanks @xdumaine/enumerateDevices
        navigator.enumerateDevices = function(callback) {
            var enumerateDevices = navigator.mediaDevices.enumerateDevices();
            if (enumerateDevices &amp;&amp; enumerateDevices.then) {
                navigator.mediaDevices.enumerateDevices().then(callback).catch(function() {
                    callback([]);
                });
            } else {
                callback([]);
            }
        };
    }

    // Media Devices detection
    var canEnumerate = false;

    /*global MediaStreamTrack:true */
    if (typeof MediaStreamTrack !== &apos;undefined&apos; &amp;&amp; &apos;getSources&apos; in MediaStreamTrack) {
        canEnumerate = true;
    } else if (navigator.mediaDevices &amp;&amp; !!navigator.mediaDevices.enumerateDevices) {
        canEnumerate = true;
    }

    var hasMicrophone = false;
    var hasSpeakers = false;
    var hasWebcam = false;

    var isWebsiteHasMicrophonePermissions = false;
    var isWebsiteHasWebcamPermissions = false;

    // http://dev.w3.org/2011/webrtc/editor/getusermedia.html#mediadevices
    function checkDeviceSupport(callback) {
        if (!canEnumerate) {
            if (callback) {
                callback();
            }
            return;
        }

        if (!navigator.enumerateDevices &amp;&amp; window.MediaStreamTrack &amp;&amp; window.MediaStreamTrack.getSources) {
            navigator.enumerateDevices = window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack);
        }

        if (!navigator.enumerateDevices &amp;&amp; navigator.enumerateDevices) {
            navigator.enumerateDevices = navigator.enumerateDevices.bind(navigator);
        }

        if (!navigator.enumerateDevices) {
            if (callback) {
                callback();
            }
            return;
        }

        MediaDevices = [];

        audioInputDevices = [];
        audioOutputDevices = [];
        videoInputDevices = [];

        hasMicrophone = false;
        hasSpeakers = false;
        hasWebcam = false;

        isWebsiteHasMicrophonePermissions = false;
        isWebsiteHasWebcamPermissions = false;

        // to prevent duplication
        var alreadyUsedDevices = {};

        navigator.enumerateDevices(function(devices) {
            devices.forEach(function(_device) {
                var device = {};
                for (var d in _device) {
                    try {
                        if (typeof _device[d] !== &apos;function&apos;) {
                            device[d] = _device[d];
                        }
                    } catch (e) {}
                }

                if (alreadyUsedDevices[device.deviceId + device.label + device.kind]) {
                    return;
                }

                // if it is MediaStreamTrack.getSources
                if (device.kind === &apos;audio&apos;) {
                    device.kind = &apos;audioinput&apos;;
                }

                if (device.kind === &apos;video&apos;) {
                    device.kind = &apos;videoinput&apos;;
                }

                if (!device.deviceId) {
                    device.deviceId = device.id;
                }

                if (!device.id) {
                    device.id = device.deviceId;
                }

                if (!device.label) {
                    device.isCustomLabel = true;

                    if (device.kind === &apos;videoinput&apos;) {
                        device.label = &apos;Camera &apos; + (videoInputDevices.length + 1);
                    } else if (device.kind === &apos;audioinput&apos;) {
                        device.label = &apos;Microphone &apos; + (audioInputDevices.length + 1);
                    } else if (device.kind === &apos;audiooutput&apos;) {
                        device.label = &apos;Speaker &apos; + (audioOutputDevices.length + 1);
                    } else {
                        device.label = &apos;Please invoke getUserMedia once.&apos;;
                    }

                    if (typeof DetectRTC !== &apos;undefined&apos; &amp;&amp; DetectRTC.browser.isChrome &amp;&amp; DetectRTC.browser.version &gt;= 46 &amp;&amp; !/^(https:|chrome-extension:)$/g.test(location.protocol || &apos;&apos;)) {
                        if (typeof document !== &apos;undefined&apos; &amp;&amp; typeof document.domain === &apos;string&apos; &amp;&amp; document.domain.search &amp;&amp; document.domain.search(/localhost|127.0./g) === -1) {
                            device.label = &apos;HTTPs is required to get label of this &apos; + device.kind + &apos; device.&apos;;
                        }
                    }
                } else {
                    // Firefox on Android still returns empty label
                    if (device.kind === &apos;videoinput&apos; &amp;&amp; !isWebsiteHasWebcamPermissions) {
                        isWebsiteHasWebcamPermissions = true;
                    }

                    if (device.kind === &apos;audioinput&apos; &amp;&amp; !isWebsiteHasMicrophonePermissions) {
                        isWebsiteHasMicrophonePermissions = true;
                    }
                }

                if (device.kind === &apos;audioinput&apos;) {
                    hasMicrophone = true;

                    if (audioInputDevices.indexOf(device) === -1) {
                        audioInputDevices.push(device);
                    }
                }

                if (device.kind === &apos;audiooutput&apos;) {
                    hasSpeakers = true;

                    if (audioOutputDevices.indexOf(device) === -1) {
                        audioOutputDevices.push(device);
                    }
                }

                if (device.kind === &apos;videoinput&apos;) {
                    hasWebcam = true;

                    if (videoInputDevices.indexOf(device) === -1) {
                        videoInputDevices.push(device);
                    }
                }

                // there is no &apos;videoouput&apos; in the spec.
                MediaDevices.push(device);

                alreadyUsedDevices[device.deviceId + device.label + device.kind] = device;
            });

            if (typeof DetectRTC !== &apos;undefined&apos;) {
                // to sync latest outputs
                DetectRTC.MediaDevices = MediaDevices;
                DetectRTC.hasMicrophone = hasMicrophone;
                DetectRTC.hasSpeakers = hasSpeakers;
                DetectRTC.hasWebcam = hasWebcam;

                DetectRTC.isWebsiteHasWebcamPermissions = isWebsiteHasWebcamPermissions;
                DetectRTC.isWebsiteHasMicrophonePermissions = isWebsiteHasMicrophonePermissions;

                DetectRTC.audioInputDevices = audioInputDevices;
                DetectRTC.audioOutputDevices = audioOutputDevices;
                DetectRTC.videoInputDevices = videoInputDevices;
            }

            if (callback) {
                callback();
            }
        });
    }

    var DetectRTC = window.DetectRTC || {};

    // ----------
    // DetectRTC.browser.name || DetectRTC.browser.version || DetectRTC.browser.fullVersion
    DetectRTC.browser = getBrowserInfo();

    detectPrivateMode(function(isPrivateBrowsing) {
        DetectRTC.browser.isPrivateBrowsing = !!isPrivateBrowsing;
    });

    // DetectRTC.isChrome || DetectRTC.isFirefox || DetectRTC.isEdge
    DetectRTC.browser[&apos;is&apos; + DetectRTC.browser.name] = true;

    // -----------
    DetectRTC.osName = osName;
    DetectRTC.osVersion = osVersion;

    var isNodeWebkit = typeof process === &apos;object&apos; &amp;&amp; typeof process.versions === &apos;object&apos; &amp;&amp; process.versions[&apos;node-webkit&apos;];

    // --------- Detect if system supports WebRTC 1.0 or WebRTC 1.1.
    var isWebRTCSupported = false;
    [&apos;RTCPeerConnection&apos;, &apos;webkitRTCPeerConnection&apos;, &apos;mozRTCPeerConnection&apos;, &apos;RTCIceGatherer&apos;].forEach(function(item) {
        if (isWebRTCSupported) {
            return;
        }

        if (item in window) {
            isWebRTCSupported = true;
        }
    });
    DetectRTC.isWebRTCSupported = isWebRTCSupported;

    //-------
    DetectRTC.isORTCSupported = typeof RTCIceGatherer !== &apos;undefined&apos;;

    // --------- Detect if system supports screen capturing API
    var isScreenCapturingSupported = false;
    if (DetectRTC.browser.isChrome &amp;&amp; DetectRTC.browser.version &gt;= 35) {
        isScreenCapturingSupported = true;
    } else if (DetectRTC.browser.isFirefox &amp;&amp; DetectRTC.browser.version &gt;= 34) {
        isScreenCapturingSupported = true;
    } else if (DetectRTC.browser.isEdge &amp;&amp; DetectRTC.browser.version &gt;= 17) {
        isScreenCapturingSupported = true; // navigator.getDisplayMedia
    } else if (DetectRTC.osName === &apos;Android&apos; &amp;&amp; DetectRTC.browser.isChrome) {
        isScreenCapturingSupported = true;
    }

    if (!/^(https:|chrome-extension:)$/g.test(location.protocol || &apos;&apos;)) {
        var isNonLocalHost = typeof document !== &apos;undefined&apos; &amp;&amp; typeof document.domain === &apos;string&apos; &amp;&amp; document.domain.search &amp;&amp; document.domain.search(/localhost|127.0./g) === -1;
        if (isNonLocalHost &amp;&amp; (DetectRTC.browser.isChrome || DetectRTC.browser.isEdge || DetectRTC.browser.isOpera)) {
            isScreenCapturingSupported = false;
        } else if (DetectRTC.browser.isFirefox) {
            isScreenCapturingSupported = false;
        }
    }
    DetectRTC.isScreenCapturingSupported = isScreenCapturingSupported;

    // --------- Detect if WebAudio API are supported
    var webAudio = {
        isSupported: false,
        isCreateMediaStreamSourceSupported: false
    };

    [&apos;AudioContext&apos;, &apos;webkitAudioContext&apos;, &apos;mozAudioContext&apos;, &apos;msAudioContext&apos;].forEach(function(item) {
        if (webAudio.isSupported) {
            return;
        }

        if (item in window) {
            webAudio.isSupported = true;

            if (window[item] &amp;&amp; &apos;createMediaStreamSource&apos; in window[item].prototype) {
                webAudio.isCreateMediaStreamSourceSupported = true;
            }
        }
    });
    DetectRTC.isAudioContextSupported = webAudio.isSupported;
    DetectRTC.isCreateMediaStreamSourceSupported = webAudio.isCreateMediaStreamSourceSupported;

    // ---------- Detect if SCTP/RTP channels are supported.

    var isRtpDataChannelsSupported = false;
    if (DetectRTC.browser.isChrome &amp;&amp; DetectRTC.browser.version &gt; 31) {
        isRtpDataChannelsSupported = true;
    }
    DetectRTC.isRtpDataChannelsSupported = isRtpDataChannelsSupported;

    var isSCTPSupportd = false;
    if (DetectRTC.browser.isFirefox &amp;&amp; DetectRTC.browser.version &gt; 28) {
        isSCTPSupportd = true;
    } else if (DetectRTC.browser.isChrome &amp;&amp; DetectRTC.browser.version &gt; 25) {
        isSCTPSupportd = true;
    } else if (DetectRTC.browser.isOpera &amp;&amp; DetectRTC.browser.version &gt;= 11) {
        isSCTPSupportd = true;
    }
    DetectRTC.isSctpDataChannelsSupported = isSCTPSupportd;

    // ---------

    DetectRTC.isMobileDevice = isMobileDevice; // &quot;isMobileDevice&quot; boolean is defined in &quot;getBrowserInfo.js&quot;

    // ------
    var isGetUserMediaSupported = false;
    if (navigator.getUserMedia) {
        isGetUserMediaSupported = true;
    } else if (navigator.mediaDevices &amp;&amp; navigator.mediaDevices.getUserMedia) {
        isGetUserMediaSupported = true;
    }

    if (DetectRTC.browser.isChrome &amp;&amp; DetectRTC.browser.version &gt;= 46 &amp;&amp; !/^(https:|chrome-extension:)$/g.test(location.protocol || &apos;&apos;)) {
        if (typeof document !== &apos;undefined&apos; &amp;&amp; typeof document.domain === &apos;string&apos; &amp;&amp; document.domain.search &amp;&amp; document.domain.search(/localhost|127.0./g) === -1) {
            isGetUserMediaSupported = &apos;Requires HTTPs&apos;;
        }
    }

    if (DetectRTC.osName === &apos;Nodejs&apos;) {
        isGetUserMediaSupported = false;
    }
    DetectRTC.isGetUserMediaSupported = isGetUserMediaSupported;

    var displayResolution = &apos;&apos;;
    if (screen.width) {
        var width = (screen.width) ? screen.width : &apos;&apos;;
        var height = (screen.height) ? screen.height : &apos;&apos;;
        displayResolution += &apos;&apos; + width + &apos; x &apos; + height;
    }
    DetectRTC.displayResolution = displayResolution;

    function getAspectRatio(w, h) {
        function gcd(a, b) {
            return (b == 0) ? a : gcd(b, a % b);
        }
        var r = gcd(w, h);
        return (w / r) / (h / r);
    }

    DetectRTC.displayAspectRatio = getAspectRatio(screen.width, screen.height).toFixed(2);

    // ----------
    DetectRTC.isCanvasSupportsStreamCapturing = isCanvasSupportsStreamCapturing;
    DetectRTC.isVideoSupportsStreamCapturing = isVideoSupportsStreamCapturing;

    if (DetectRTC.browser.name == &apos;Chrome&apos; &amp;&amp; DetectRTC.browser.version &gt;= 53) {
        if (!DetectRTC.isCanvasSupportsStreamCapturing) {
            DetectRTC.isCanvasSupportsStreamCapturing = &apos;Requires chrome flag: enable-experimental-web-platform-features&apos;;
        }

        if (!DetectRTC.isVideoSupportsStreamCapturing) {
            DetectRTC.isVideoSupportsStreamCapturing = &apos;Requires chrome flag: enable-experimental-web-platform-features&apos;;
        }
    }

    // ------
    DetectRTC.DetectLocalIPAddress = DetectLocalIPAddress;

    DetectRTC.isWebSocketsSupported = &apos;WebSocket&apos; in window &amp;&amp; 2 === window.WebSocket.CLOSING;
    DetectRTC.isWebSocketsBlocked = !DetectRTC.isWebSocketsSupported;

    if (DetectRTC.osName === &apos;Nodejs&apos;) {
        DetectRTC.isWebSocketsSupported = true;
        DetectRTC.isWebSocketsBlocked = false;
    }

    DetectRTC.checkWebSocketsSupport = function(callback) {
        callback = callback || function() {};
        try {
            var starttime;
            var websocket = new WebSocket(&apos;wss://echo.websocket.org:443/&apos;);
            websocket.onopen = function() {
                DetectRTC.isWebSocketsBlocked = false;
                starttime = (new Date).getTime();
                websocket.send(&apos;ping&apos;);
            };
            websocket.onmessage = function() {
                DetectRTC.WebsocketLatency = (new Date).getTime() - starttime + &apos;ms&apos;;
                callback();
                websocket.close();
                websocket = null;
            };
            websocket.onerror = function() {
                DetectRTC.isWebSocketsBlocked = true;
                callback();
            };
        } catch (e) {
            DetectRTC.isWebSocketsBlocked = true;
            callback();
        }
    };

    // -------
    DetectRTC.load = function(callback) {
        callback = callback || function() {};
        checkDeviceSupport(callback);
    };

    // check for microphone/camera support!
    if (typeof checkDeviceSupport === &apos;function&apos;) {
        // checkDeviceSupport();
    }

    if (typeof MediaDevices !== &apos;undefined&apos;) {
        DetectRTC.MediaDevices = MediaDevices;
    } else {
        DetectRTC.MediaDevices = [];
    }

    DetectRTC.hasMicrophone = hasMicrophone;
    DetectRTC.hasSpeakers = hasSpeakers;
    DetectRTC.hasWebcam = hasWebcam;

    DetectRTC.isWebsiteHasWebcamPermissions = isWebsiteHasWebcamPermissions;
    DetectRTC.isWebsiteHasMicrophonePermissions = isWebsiteHasMicrophonePermissions;

    DetectRTC.audioInputDevices = audioInputDevices;
    DetectRTC.audioOutputDevices = audioOutputDevices;
    DetectRTC.videoInputDevices = videoInputDevices;

    // ------
    var isSetSinkIdSupported = false;
    if (typeof document !== &apos;undefined&apos; &amp;&amp; typeof document.createElement === &apos;function&apos; &amp;&amp; &apos;setSinkId&apos; in document.createElement(&apos;video&apos;)) {
        isSetSinkIdSupported = true;
    }
    DetectRTC.isSetSinkIdSupported = isSetSinkIdSupported;

    // -----
    var isRTPSenderReplaceTracksSupported = false;
    if (DetectRTC.browser.isFirefox &amp;&amp; typeof mozRTCPeerConnection !== &apos;undefined&apos; /*&amp;&amp; DetectRTC.browser.version &gt; 39*/ ) {
        /*global mozRTCPeerConnection:true */
        if (&apos;getSenders&apos; in mozRTCPeerConnection.prototype) {
            isRTPSenderReplaceTracksSupported = true;
        }
    } else if (DetectRTC.browser.isChrome &amp;&amp; typeof webkitRTCPeerConnection !== &apos;undefined&apos;) {
        /*global webkitRTCPeerConnection:true */
        if (&apos;getSenders&apos; in webkitRTCPeerConnection.prototype) {
            isRTPSenderReplaceTracksSupported = true;
        }
    }
    DetectRTC.isRTPSenderReplaceTracksSupported = isRTPSenderReplaceTracksSupported;

    //------
    var isRemoteStreamProcessingSupported = false;
    if (DetectRTC.browser.isFirefox &amp;&amp; DetectRTC.browser.version &gt; 38) {
        isRemoteStreamProcessingSupported = true;
    }
    DetectRTC.isRemoteStreamProcessingSupported = isRemoteStreamProcessingSupported;

    //-------
    var isApplyConstraintsSupported = false;

    /*global MediaStreamTrack:true */
    if (typeof MediaStreamTrack !== &apos;undefined&apos; &amp;&amp; &apos;applyConstraints&apos; in MediaStreamTrack.prototype) {
        isApplyConstraintsSupported = true;
    }
    DetectRTC.isApplyConstraintsSupported = isApplyConstraintsSupported;

    //-------
    var isMultiMonitorScreenCapturingSupported = false;
    if (DetectRTC.browser.isFirefox &amp;&amp; DetectRTC.browser.version &gt;= 43) {
        // version 43 merely supports platforms for multi-monitors
        // version 44 will support exact multi-monitor selection i.e. you can select any monitor for screen capturing.
        isMultiMonitorScreenCapturingSupported = true;
    }
    DetectRTC.isMultiMonitorScreenCapturingSupported = isMultiMonitorScreenCapturingSupported;

    DetectRTC.isPromisesSupported = !!(&apos;Promise&apos; in window);

    // version is generated by &quot;grunt&quot;
    DetectRTC.version = &apos;1.3.6&apos;;

    if (typeof DetectRTC === &apos;undefined&apos;) {
        window.DetectRTC = {};
    }

    var MediaStream = window.MediaStream;

    if (typeof MediaStream === &apos;undefined&apos; &amp;&amp; typeof webkitMediaStream !== &apos;undefined&apos;) {
        MediaStream = webkitMediaStream;
    }

    if (typeof MediaStream !== &apos;undefined&apos; &amp;&amp; typeof MediaStream === &apos;function&apos;) {
        DetectRTC.MediaStream = Object.keys(MediaStream.prototype);
    } else DetectRTC.MediaStream = false;

    if (typeof MediaStreamTrack !== &apos;undefined&apos;) {
        DetectRTC.MediaStreamTrack = Object.keys(MediaStreamTrack.prototype);
    } else DetectRTC.MediaStreamTrack = false;

    var RTCPeerConnection = window.RTCPeerConnection || window.mozRTCPeerConnection || window.webkitRTCPeerConnection;

    if (typeof RTCPeerConnection !== &apos;undefined&apos;) {
        DetectRTC.RTCPeerConnection = Object.keys(RTCPeerConnection.prototype);
    } else DetectRTC.RTCPeerConnection = false;

    window.DetectRTC = DetectRTC;

    if (typeof module !== &apos;undefined&apos; /* &amp;&amp; !!module.exports*/ ) {
        module.exports = DetectRTC;
    }

    if (typeof define === &apos;function&apos; &amp;&amp; define.amd) {
        define(&apos;DetectRTC&apos;, [], function() {
            return DetectRTC;
        });
    }
})();
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>

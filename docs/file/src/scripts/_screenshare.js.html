<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/scripts/_screenshare.js | webrtcdevelopment</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="webrtc based communication and collaboration client. Contains lot of experiments modules "><meta property="twitter:card" content="summary"><meta property="twitter:title" content="webrtcdevelopment"><meta property="twitter:description" content="webrtc based communication and collaboration client. Contains lot of experiments modules "></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/altanai/webrtc"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#scripts">scripts</a><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-CanvasRecorder">CanvasRecorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-GetRecorderType">GetRecorderType</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-GifRecorder">GifRecorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MRecordRTC">MRecordRTC</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MediaStreamRecorder">MediaStreamRecorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-RecordRTC">RecordRTC</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-RecordRTCConfiguration">RecordRTCConfiguration</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-StereoAudioRecorder">StereoAudioRecorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-Whammy">Whammy</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-WhammyRecorder">WhammyRecorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-createFileSharingDiv">createFileSharingDiv</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-_turn.js">_turn.js</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#scripts-rtcconn">scripts/rtcconn</a><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-Whammy">Whammy</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/scripts/_screenshare.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/**************************************************************
Screenshare 
****************************************************************/
&apos;use strict&apos;;
&quot;use strict&quot;;
var chromeMediaSource = &apos;screen&apos;;
var sourceId , screen_constraints , screenStreamId;
var isFirefox = typeof window.InstallTrigger !== &apos;undefined&apos;;
var isOpera = !!window.opera || navigator.userAgent.indexOf(&apos; OPR/&apos;) &gt;= 0;
var isChrome = !!window.chrome &amp;&amp; !isOpera;
var isMobileDevice = !!navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i);

var scrConn, screenCallback ;
var iceServers=[];
var signaler,screen,screenRoomid;
var screenShareButton ;

var screenShareStreamLocal = null;

/**
 * function to get the sourceID from chorme extension 
 * @method
 * @name getSourceId
 * @param {function} callback
 * @param {string} audioPlusTab
 */
/* getsourceID in RTCmtulconn has been commented to make the below one active */
function getSourceId(callback, audioPlusTab) {
    if (!callback)
        throw &apos;&quot;callback&quot; parameter is mandatory.&apos;;

    window.postMessage(&quot;webrtcdev-extension-getsourceId&quot;, &quot;*&quot;);
}

/**
 * function to get the sourceID from chorme extension 
 * @method
 * @name getSourceId
 * @param {function} callback
 * @param {string} audioPlusTab
 */
function getChromeExtensionStatus(extensionid, callback) {
    if (2 != arguments.length &amp;&amp; (callback = extensionid, extensionid = window.RMCExtensionID || &quot;ajhifddimkapgcifgcodmmfdlknahffk&quot;), isFirefox)
        return callback(&quot;not-chrome&quot;);
    
    if(!extensionid)
        return callback(&quot;Null extensionID&quot;);

    try{
        var image = document.createElement(&quot;img&quot;);
        image.src = &quot;chrome-extension://&quot; + extensionid + &quot;/icon.png&quot;,
        image.onload = function() {
            webrtcdev.info(&quot;screenshare extension &quot; , image.src);
            chromeMediaSource = &quot;screen&quot;,
            window.postMessage(&quot;webrtcdev-extension-presence&quot;, &quot;*&quot;),
            setTimeout(function() {
                callback(&quot;screen&quot; == chromeMediaSource ? extensionid == extensionid ? &quot;installed-enabled&quot; : &quot;installed-disabled&quot; : &quot;installed-enabled&quot;)
            }, 2e3);
        },
        image.onerror = function() {
            webrtcdev.error(&quot;No screenshare extension &quot; , image.src);
            callback(&quot;not-installed&quot;);
        }
    }catch(e){
        webrtcdev.error(&quot;Screenshare extension image not found chrome-extension://&quot; , extensionid , &quot;/icon.png&quot; , e)
        callback(&quot;not-installed&quot;);
    }
}

/**
 * function to find if chromeMedia source is desktop or screen
 * @method
 * @name isChromeExtensionAvailable
 * @param {function} callback
 */
function isChromeExtensionAvailable(callback) {
    if (callback) {
        if (isFirefox)
            return isFirefoxExtensionAvailable(callback);
        if (&quot;desktop&quot; == chromeMediaSource)
            return callback(!0);
        window.postMessage(&quot;webrtcdev-extension-presence&quot;, &quot;*&quot;),
        setTimeout(function() {
            callback(&quot;screen&quot; == chromeMediaSource ? !1 : !0)
        }, 2e3)
    }
}

/**
 * function set up Srcreens share session RTC peer connection 
 * @method
 * @name webrtcdevPrepareScreenShare
 * @param {function} callback
 */
function webrtcdevPrepareScreenShare(callback){
    webrtcdev.log(&quot;[screenshareJS] webrtcdevPrepareScreenShare &quot;);

    var time            = new Date().getUTCMilliseconds(); 
    if(screenRoomid == null)
        screenRoomid    = &quot;screenshare&quot;+&quot;_&quot;+sessionid+&quot;_&quot;+time;

    localStorage.setItem(&quot;screenRoomid &quot; , screenRoomid);
    webrtcdev.log(&quot;[screenshare JS] webrtcdevPrepareScreenShare&quot; + screenRoomid);
    webrtcdev.log(&quot;[screenshare JS] filling up iceServers &quot; , turn , webrtcdevIceServers);

    scrConn  = new RTCMultiConnection();
    if(turn &amp;&amp; turn!=&apos;none&apos;){
        if(!webrtcdevIceServers) {
            alert(&quot; [screenshare JS] ICE server not found yet in screenshare session &quot;);
        }
        scrConn.iceServers  = webrtcdevIceServers;      
    }  
    
    scrConn.channel     = screenRoomid,
    scrConn.socketURL   = socketAddr,
    scrConn.session = {
        screen: true,
        oneway: true
    },
    scrConn.sdpConstraints.mandatory = {
        OfferToReceiveAudio: false,
        OfferToReceiveVideo: true
    },
    scrConn.dontCaptureUserMedia = false,

    scrConn.onMediaError = function(error, constraints) {
        webrtcdev.error(error, constraints);
        shownotificationWarning(error.name);
    },

    scrConn.onstream = function(event) {
        webrtcdev.log(&quot;[screenshareJS] on stream in _screenshare :&quot; , event);

        if (debug) {
            var nameBox = document.createElement(&quot;span&quot;);
            nameBox.innerHTML = &quot;&lt;br/&gt;&quot; + screenRoomid + &quot;&lt;br/&gt;&quot;;
            document.getElementById(screenshareobj.screenshareContainer).appendChild(nameBox);
        }

        //if(event.stream.isScreen){
            if(event.type==&quot;remote&quot; &amp;&amp; event.type!=&quot;local&quot;){
                shownotificationWarning(&quot;started streaming remote&apos;s screen&quot;);
                webrtcdev.log(&quot;[screensharejs] on stream remote &quot;);
                var userid = event.userid;
                var type = event.type;
                var stream = event.stream;
                if(event.stream.streamid){
                    webrtcdev.log(&quot;remote screen event.stream.streamId &quot; + event.stream.streamId);
                    screenStreamId=event.stream.streamid;                    
                }else if(event.streamid){
                    webrtcdev.log(&quot;remote screen event.streamid &quot; + event.streamid);
                    screenStreamId=event.streamid;  
                }

                var video = document.createElement(&apos;video&apos;);
                //video.autoplay=&quot;autoplay&quot;;
                attachMediaStream(video, stream);
                //video.id = peerInfo.videoContainer;
                document.getElementById(screenshareobj.screenshareContainer).appendChild(video);
                document.getElementById(screenshareobj.screenshareContainer).hidden=false;
                rtcConn.send({
                    type:&quot;screenshare&quot;, 
                    screenid: screenRoomid,
                    message:&quot;screenshareStartedViewing&quot;
                });

            }else{
                shownotificationWarning(&quot;started streaming local screen&quot;);
                webrtcdev.log(&quot;[screenshareJS] on stream local &quot;)
                //screenshareNotification(&quot;&quot;,&quot;screenshareBegin&quot;); 
                rtcConn.send({
                    type:&quot;screenshare&quot;, 
                    screenid: screenRoomid,
                    screenStreamid: screenStreamId,
                    message:&quot;startscreenshare&quot;
                });

            }

            //createScreenViewButton();

            // Event Listner for Screen share stream started 
            onScreenShareStarted();

            /*scrConn.videosContainer.appendChild(event.mediaElement);
            event.mediaElement.play();
            setTimeout(function() {
                event.mediaElement.play();
            }, 5000);*/
        //}
    },

    scrConn.onstreamended = function(event) {
        if(event)
            webrtcdev.log(&quot;[screenshare JS] onstreamended in _screenshare :&quot; , event);
    
        if(document.getElementById(screenshareobj.screenshareContainer)){
            document.getElementById(screenshareobj.screenshareContainer).innerHTML=&quot;&quot;;
        }

        scrConn.removeStream(screenStreamId);
        if(screenShareButton){
            screenShareButton.className = screenshareobj.button.shareButton.class_off;
            screenShareButton.innerHTML = screenshareobj.button.shareButton.html_off;
        }
        //removeScreenViewButton();
    };

    webrtcdev.log(&quot;[screenshare JS] webrtcdevscreenshare calling callback for socket.io operations&quot;);
    //alert(&quot; Preparing Screenshare &quot;+ screenRoomid);
    setTimeout(callback(screenRoomid), 3000);
    // event listener for Screen share stream ended 
    onScreenShareSEnded();
}

function webrtcdevSharescreen() {
    webrtcdev.log(&quot;[screenshare JS] webrtcdevSharescreen  , screenRoomid = &quot; , screenRoomid );

    webrtcdevPrepareScreenShare(function(screenRoomid){

        //var selfuserid = &quot;temp_&quot;+(new Date().getUTCMilliseconds());
        scrConn.dontCaptureUserMedia = false,
        //scrConn.captureUserMedia();
        //scrConn.getUserMedia();
        scrConn.open(screenRoomid, function() {
            webrtcdev.log(&quot;[screenshare JS] Event : open-channel-screenshare&quot; );
            socket.emit(&quot;open-channel-screenshare&quot;, {
                channel    : screenRoomid,
                sender     : selfuserid,
                maxAllowed : 6
            });

            shownotification(&quot;Making a new session for screenshare&quot; + screenRoomid);
        });

        socket.on(&quot;open-channel-screenshare-resp&quot;,function(event) {
            webrtcdev.log(&quot;[screenshare JS] Event Handler : open-channel-screenshare-response &quot; , event);
            if(event) connectScrWebRTC(&quot;open&quot; , screenRoomid, selfuserid, []); 
        });
    });
    /*    
    if(Object.keys(scrConn.streamEvents).length&gt;2){   
        scrConn.addStream({
            screen: true,
            oneway: true
        });
        shownotification(&quot; ReStarting Screenshare session &quot;+roomid);
        rtcMultiConnection.send({
            type:&quot;screenshare&quot;, 
            message:roomid
        });
        return ;
    }*/

    //webrtcdev.log(&quot;webrtcdevscreenshare . srcConn = &quot; , scrConn , &quot; | rtcConn = &quot; ,  rtcConn);
}

function connectScrWebRTC(type, channel , userid , remoteUsers){
    webrtcdev.log(&quot;connectScrWebRTC -&gt; &quot; , type, channel , userid , remoteUsers);
    if(type==&quot;open&quot;){
        scrConn.connect(screenRoomid);
        shownotification(&quot;Connected to &quot;+ screenRoomid + &quot; for screenshare &quot;);
    }else if(type==&quot;join&quot;){
        scrConn.join(screenRoomid);
        shownotification(&quot;Connected with existing Screenshare channel &quot;+ screenRoomid);
    }else{
        shownotification(&quot;Connection type not found for Screenshare &quot;);
    }
}

function webrtcdevScreenConstraints(chromeMediaSourceId) {
    webrtcdev.log(&quot;[screenshare JS] webrtcdevScreenConstraints  - chromeMediaSourceId: &quot;, chromeMediaSourceId);
    screen_constraints = {
        audio: false,
        video: {
            mandatory: {
                chromeMediaSource: &apos;desktop&apos;,
                chromeMediaSourceId: chromeMediaSourceId,
                maxWidth: window.screen.width &gt; 1920 ? window.screen.width : 1920,
                maxHeight: window.screen.height &gt; 1080 ? window.screen.height : 1080
            },
            optional: []
        }
    };
    
    /*    
    scrConn.getScreenConstraints = function(callback) {
        alert(&quot;getScreenConstraints&quot;);
        screen_constraints = scrConn.modifyScreenConstraints(screen_constraints);
        webrtcdev.log(&quot;screen_constraints&quot;, screen_constraints);
        callback(false, screen_constraints);
        return;
    };*/
    try {
        webrtcdev.log(&quot; screen getusermedia &quot;);
        navigator.getUserMedia(screen_constraints ,
            function stream(event) {
                webrtcdev.log(&quot;[screenshare JS] screen stream event and container &quot;  , event , screenshareobj.screenshareContainer);
                //scrConn.onstream(event);
                //screenStreamId = event.streamid;
                //var videosContainer = document.createElement(&quot;video&quot;);
                //videosContainer.src = window.URL.createObjectURL(event);
                //container.appendChild(videosContainer);
                //videosContainer.appendChild(event.mediaElement);
                var stream = event;
                screenShareStreamLocal = event;
                webrtcdev.log(&quot;[screenshare JS] Stream from getUserMedia&quot; , stream);
                stream.type = &quot;local&quot;,
                //scrConn.setStreamEndHandler(stream),
                getRMCMediaElement(stream, function(mediaElement) {
                    webrtcdev.log(&quot;[screenshare JS] getRMCMediaElement Callback , streamid = &quot; + stream.streamid +&quot; ,  id = &quot; + stream.id);
                    if(stream.streamid){
                        webrtcdev.log(&quot;[screenshare JS] getRMCMediaElement Callback  ,  using streamid&quot;);
                        mediaElement.id = stream.streamid,
                        mediaElement.muted = !0,
                        mediaElement.volume = 0,
                        -1 === scrConn.attachStreams.indexOf(stream) &amp;&amp; scrConn.attachStreams.push(stream),
                        &quot;undefined&quot; != typeof StreamsHandler &amp;&amp; StreamsHandler.setHandlers(stream, !0, scrConn),
                        scrConn.streamEvents[stream.streamid] = {
                            stream: stream,
                            type: &quot;local&quot;,
                            mediaElement: mediaElement,
                            userid: scrConn.userid,
                            extra: scrConn.extra,
                            streamid: stream.streamid,
                            blobURL: mediaElement.src || URL.createObjectURL(stream),
                            /*blobURL: mediaElement.src || mediaElement.srcObject ,*/
                            isAudioMuted: !0
                        };
                        scrConn.onstream(scrConn.streamEvents[stream.streamid])
                    }else if(stream.id){
                        webrtcdev.log(&quot;[screenshare JS] getRMCMediaElement Callback  ,  using id&quot;);
                        mediaElement.id = stream.id,
                        mediaElement.muted = !0,
                        mediaElement.volume = 0,
                        -1 === scrConn.attachStreams.indexOf(stream) &amp;&amp; scrConn.attachStreams.push(stream),
                        &quot;undefined&quot; != typeof StreamsHandler &amp;&amp; StreamsHandler.setHandlers(stream, !0, scrConn),
                        scrConn.streamEvents[stream.id] = {
                            stream: stream,
                            type: &quot;local&quot;,
                            mediaElement: mediaElement,
                            userid: scrConn.userid,
                            extra: scrConn.extra,
                            streamid: stream.id,
                            blobURL: mediaElement.src || URL.createObjectURL(stream),
                            /*blobURL: mediaElement.src || mediaElement.srcObject ,*/
                            isAudioMuted: !0
                        };
                        webrtcdev.log(&quot; [screenshare JS] Stream object  &quot; , scrConn.streamEvents[stream.id]);
                        /*setHarkEvents(scrConn, scrConn.streamEvents[stream.streamid]),*/
                        /*setMuteHandlers(scrConn, scrConn.streamEvents[stream.streamid]),*/
                        scrConn.onstream(scrConn.streamEvents[stream.id])
                    }else{
                        alert(&quot;screenshare has neither streamid not id&quot;);
                    }
                }, scrConn);

            },
            function error(err) {
                webrtcdev.error(&quot;[screenshare JS] Error in webrtcdevScreenConstraints &quot; , err);
                if (isChrome &amp;&amp; location.protocol === &apos;http:&apos;) {
                    alert(&apos;Please test this WebRTC experiment on HTTPS.&apos;);
                } else if(isChrome) {
                    alert(&apos;Screen capturing is either denied or not supported. Please install chrome extension for screen capturing or run chrome with command-line flag: --enable-usermedia-screen-capturing&apos;);
                } else if(!!navigator.mozGetUserMedia) {
                    alert(Firefox_Screen_Capturing_Warning);
                }
            }
        );
   }catch(e){
        webrtcdev.log(&quot;[screenshare JS] Error in webrtcdevScreenConstraints &quot; , err);
   }

}

function getRMCMediaElement(stream, callback, connection) {
    webrtcdev.log(&quot;[screenshare JS] getRMCMediaElement &quot;  , stream , connection);
    var isAudioOnly = !1;
    stream.getVideoTracks &amp;&amp; !stream.getVideoTracks().length &amp;&amp; (isAudioOnly = !0);
    var mediaElement = document.createElement(isAudioOnly ? &quot;audio&quot; : &quot;video&quot;);
    /*        
    mediaElement[isFirefox ? &quot;mozSrcObject&quot; : &quot;src&quot;] = isFirefox ? stream : window.URL.createObjectURL(stream),
        [Deprecation] URL.createObjectURL with media streams is deprecated and will be removed in M68, around July 2018. 
        Please use HTMLMediaElement.srcObject instead. 
        See https://www.chromestatus.com/features/5618491470118912 for more details.*/

    return  ( 
        mediaElement[&quot;src&quot;] = stream,
        mediaElement.controls = !0,
        isFirefox &amp;&amp; mediaElement.addEventListener(&quot;ended&quot;, function() {
            if (currentUserMediaRequest.remove(stream.idInstance), &quot;local&quot; === stream.type) {
                StreamsHandler.onSyncNeeded(stream.streamid, &quot;ended&quot;),
                connection.attachStreams.forEach(function(aStream, idx) {
                    stream.streamid === aStream.streamid &amp;&amp; delete connection.attachStreams[idx]
                });
                var newStreamsArray = [];
                connection.attachStreams.forEach(function(aStream) {
                    aStream &amp;&amp; newStreamsArray.push(aStream)
                }),
                connection.attachStreams = newStreamsArray;
                var streamEvent = connection.streamEvents[stream.streamid];
                if (streamEvent)
                    return void connection.onstreamended(streamEvent);
                this.parentNode &amp;&amp; this.parentNode.removeChild(this)
            }
        }, !1),
    mediaElement.play(),
    void callback(mediaElement))
}

function webrtcdevViewscreen(roomid){
    scrConn.join(roomid);
}

/**
 * function stop screen share session RTC peer connection 
 * @method
 * @name webrtcdevStopShareScreen
 */
function webrtcdevStopShareScreen(){
    try{
        /*
        scrConn.removeStream({
            screen: true,  // it will remove all screen streams
            stop: true     // ask to stop old stream
        });*/
        if(screenshareobj.screenshareContainer)
            document.getElementById(screenshareobj.screenshareContainer).innerHTML=&quot;&quot;;

        rtcConn.send({
            type:&quot;screenshare&quot;, 
            screenid: screenRoomid,
            screenStreamid: screenStreamId,
            message:&quot;stoppedscreenshare&quot;
        });

        window.postMessage(&quot;webrtcdev-extension-stopsource&quot;, &quot;*&quot;);
        scrConn.onstreamended();
        scrConn.close();
        scrConn.closeEntireSession();
        webrtcdev.log(&quot;[screenshare JS] Sender stopped: screenRoomid &quot;+ screenRoomid +&quot; || Screen stoppped &quot;  , scrConn , document.getElementById(screenshareobj.screenshareContainer));
        
        if(screenShareStreamLocal){
            screenShareStreamLocal.stop();
            screenShareStreamLocal=null;        
        }
        //scrConn.videosContainer.hidden=true;
        /*scrConn.leave();*/
        //removeScreenViewButton();

    }catch(e){
        webrtcdev.error(e);
    }
}

function createOrAssignScreenviewButton(){
    if(screenshareobj.button.viewButton.id &amp;&amp; document.getElementById(screenshareobj.button.viewButton.id)) 
        assignScreenViewButton();
    else
        createScreenViewButton();
}

function createScreenViewButton(){
    if(document.getElementById(&quot;viewScreenShareButton&quot;))
        return;
    var viewScreenShareButton= document.createElement(&quot;span&quot;);
    viewScreenShareButton.className=screenshareobj.button.viewButton.class_off;
    viewScreenShareButton.innerHTML=screenshareobj.button.viewButton.html_off;
    viewScreenShareButton.id=&quot;viewScreenShareButton&quot;;
    webrtcdevViewscreen(screenRoomid);
    viewScreenShareButton.onclick = function() {
        if(viewScreenShareButton.className==screenshareobj.button.viewButton.class_off){
            document.getElementById(screenshareobj.screenshareContainer).hidden=false;
            viewScreenShareButton.className=screenshareobj.button.viewButton.class_on;
            viewScreenShareButton.innerHTML=screenshareobj.button.viewButton.html_on;
        }else if(viewScreenShareButton.className==screenshareobj.button.viewButton.class_on){
            document.getElementById(screenshareobj.screenshareContainer).hidden=true;
            viewScreenShareButton.className=screenshareobj.button.viewButton.class_off;
            viewScreenShareButton.innerHTML=screenshareobj.button.viewButton.html_off;
        }
    };

    if(document.getElementById(&quot;topIconHolder_ul&quot;)){
        var li =document.createElement(&quot;li&quot;);
        li.appendChild(viewScreenShareButton);
        document.getElementById(&quot;topIconHolder_ul&quot;).appendChild(li);
    }
}

function assignScreenViewButton(){
    /*    
    if(document.getElementById(screenshareobj.button.viewButton.id))
        return;*/
    var button =document.getElementById(screenshareobj.button.viewButton.id);
    webrtcdevViewscreen(screenRoomid);
    button.onclick = function() {
        if(button.className==screenshareobj.button.viewButton.class_off){
            document.getElementById(screenshareobj.screenshareContainer).hidden=false;
            button.className=screenshareobj.button.viewButton.class_on;
            button.innerHTML=screenshareobj.button.viewButton.html_on;
        }else if(button.className==screenshareobj.button.viewButton.class_on){
            document.getElementById(screenshareobj.screenshareContainer).hidden=true;
            button.className=screenshareobj.button.viewButton.class_off;
            button.innerHTML=screenshareobj.button.viewButton.html_off;
        }
    };
}

function removeScreenViewButton(){
    if(document.getElementById(&quot;viewScreenShareButton&quot;)){
        var elem = document.getElementById(&quot;viewScreenShareButton&quot;);
        elem.parentElement.removeChild(elem);
    }
    return;
}

function createScreenInstallButton(extensionID){
    var button= document.createElement(&quot;span&quot;);
    button.className = screenshareobj.button.installButton.class_off;
    button.innerHTML = screenshareobj.button.installButton.html_off;
    button.id=&quot;screeninstallButton&quot;;
    button.onclick = function(e) {    
        chrome.webstore.install(&quot;https://chrome.google.com/webstore/detail/&quot;+extensionID,
        function(){
            webrtcdev.log(&quot;Chrome extension inline installation - success . createOrAssignScreenshareButton with &quot; , screenshareobj);
            button.hidden = true;
            getSourceId(function () { }, true);
            createOrAssignScreenshareButton(screenshareobj);

        },function (err){
            webrtcdev.log(&quot;Chrome extension inline installation - fail &quot; , err);
        });
        // Prevent the opening of the Web Store page
        e.preventDefault();
    };
    var li =document.createElement(&quot;li&quot;);
    li.appendChild(button);
    document.getElementById(&quot;topIconHolder_ul&quot;).appendChild(li);
}

function assignScreenInstallButton(extensionID) {
    var button = document.getElementById(screenshareobj.button.installButton.id);
    button.onclick= function(e) {    
        chrome.webstore.install(&quot;https://chrome.google.com/webstore/detail/&quot;+extensionID,
            function(){
                webrtcdev.log(&quot;Chrome extension inline installation - success from assignScreenInstallButton . Now  createOrAssignScreenshareButton with &quot; , screenshareobj);
                button.hidden = true;
                getSourceId(function () { }, true);
                createOrAssignScreenshareButton(screenshareobj);
            },function (e){
                webrtcdev.error(&quot;Chrome extension inline installation - fail &quot; , e);
            });
        // Prevent the opening of the Web Store page
        e.preventDefault();
    }
}

function hideScreenInstallButton(){
    var button=document.getElementById(screenshareobj.button.installButton.id);
    button.hidden=true;
    button.setAttribute(&quot;style&quot;,&quot;display:none&quot;);
}

function createOrAssignScreenshareButton(screenshareobj){
    webrtcdev.log( &quot;createOrAssignScreenshareButton &quot; , screenshareobj);
    if(screenshareobj.button.shareButton.id &amp;&amp; document.getElementById(screenshareobj.button.shareButton.id)) {
        assignScreenShareButton();
        hideScreenInstallButton();
        showScreenShareButton();
    }    
    else{
        createScreenShareButton();
    }
}

function createScreenshareButton(){
    screenShareButton= document.createElement(&quot;span&quot;);
    screenShareButton.className = screenshareobj.button.shareButton.class_off;
    screenShareButton.innerHTML = screenshareobj.button.shareButton.html_off;
    screenShareButton.id=&quot;screenShareButton&quot;;
    screenShareButton.onclick = function(event) {    
        if(screenShareButton.className==screenshareobj.button.shareButton.class_off){
            webrtcdevSharescreen();
            screenShareButton.className=screenshareobj.button.shareButton.class_on;
            screenShareButton.innerHTML=screenshareobj.button.shareButton.html_on;
        }else if(screenShareButton.className==screenshareobj.button.shareButton.class_on){
            screenShareButton.className=screenshareobj.button.shareButton.class_off;
            screenShareButton.innerHTML=screenshareobj.button.shareButton.html_off;
            webrtcdevStopShareScreen();
        }
    };
    var li =document.createElement(&quot;li&quot;);
    li.appendChild(screenShareButton);
    document.getElementById(&quot;topIconHolder_ul&quot;).appendChild(li);
    return screenShareButton;
}

function assignScreenShareButton(){
    webrtcdev.log(&quot;assignScreenShareButton&quot;);
    var button = document.getElementById(screenshareobj.button.shareButton.id);
    button.onclick = function(event) {
        if(button.className == screenshareobj.button.shareButton.class_off){
            webrtcdevSharescreen();
            button.className = screenshareobj.button.shareButton.class_on;
            button.innerHTML = screenshareobj.button.shareButton.html_on;
        }else{
            button.className = screenshareobj.button.shareButton.class_off;
            button.innerHTML = screenshareobj.button.shareButton.html_off;
            webrtcdevStopShareScreen();
        }
    }
    return button;
}

function hideScreenShareButton(){
    var button=document.getElementById(screenshareobj.button.shareButton.id);
    button.hidden=true;
    button.setAttribute(&quot;style&quot;,&quot;display:none&quot;);
}

function showScreenShareButton(){
    var button=document.getElementById(screenshareobj.button.shareButton.id);
    button.removeAttribute(&quot;hidden&quot;);
    button.setAttribute(&quot;style&quot;,&quot;display:block&quot;);
}

/*
//shifted to start.js
window.addEventListener(&apos;message&apos;, onScreenshareExtensionCallback);*/

function onScreenshareExtensionCallback(event){
    webrtcdev.log(&quot;onScreenshareExtensionCallback&quot; , event);

    if (event.data.chromeExtensionStatus) {
       webrtcdev.log(event.data.chromeExtensionStatus);
    }

    if (event.data.sourceId) {
        if (event.data.sourceId === &apos;PermissionDeniedError&apos;) {
            webrtcdev.error(&apos;permission-denied&apos;);
        } else{
            webrtcdevScreenConstraints(event.data.sourceId);
        }
    }
}

function detectExtension(extensionID , callback){
    webrtcdev.log(&quot;detectExtension  &quot;, extensionID);
    return getChromeExtensionStatus(extensionID, function (status) {  
        //log sttaus 
        webrtcdev.log(&quot;status extension &quot;, status);
        //reset extension&apos;s local storage objects 
        webrtcdev.log(&quot;reset extension &quot;, extensionID);
        if (status !=&quot;not-installed&quot;)
            window.postMessage(&quot;reset-webrtcdev-extension&quot;, &quot;*&quot;);
        callback(status);
    });
}


function showSrcConn(){
    webrtcdev.log(&quot; srcConn : &quot;  , srcConn);
    webrtcdev.log(&quot; srcConn.peers.getAllParticipants() : &quot; , srcConn.peers.getAllParticipants());
}


var counterBeforeFailureNotice=0;
function screenshareNotification(message , type){

    if(document.getElementById(&quot;alertBox&quot;)){
        
        document.getElementById(&quot;alertBox&quot;).innerHTML=&quot;&quot;;

        if(type==&quot;screenshareBegin&quot;){

            var alertDiv =document.createElement(&quot;div&quot;);
            document.getElementById(&quot;alertBox&quot;).hidden=false;
            document.getElementById(&quot;alertBox&quot;).innerHTML=&quot;&quot;;
            alertDiv.className=&quot;alert alert-info&quot;;
            alertDiv.innerHTML=&apos;&lt;a href=&quot;#&quot; class=&quot;close&quot; data-dismiss=&quot;alert&quot; aria-label=&quot;close&quot;&gt;&amp;times;&lt;/a&gt;&apos;+ &quot;You have begun sharing screen , waiting for peer to view&quot;;
            document.getElementById(&quot;alertBox&quot;).appendChild(alertDiv);

            setTimeout(function() {
                var alertDiv = document.createElement(&quot;div&quot;);
                document.getElementById(&quot;alertBox&quot;).hidden=false;
                document.getElementById(&quot;alertBox&quot;).innerHTML=&quot;&quot;;
                alertDiv.className=&quot;alert alert-danger&quot;;
                alertDiv.innerHTML=&apos;&lt;a href=&quot;#&quot; class=&quot;close&quot; data-dismiss=&quot;alert&quot; aria-label=&quot;close&quot;&gt;&amp;times;&lt;/a&gt;&apos;+ &quot;Peer was not able to view screen , please retry&quot;;
                document.getElementById(&quot;alertBox&quot;).appendChild(alertDiv);
            }, 20000);

        }else if(type==&quot;screenshareStartedViewing&quot;){
                
            var alertDiv =document.createElement(&quot;div&quot;);
            document.getElementById(&quot;alertBox&quot;).hidden=false;
            document.getElementById(&quot;alertBox&quot;).innerHTML=&quot;&quot;;
            alertDiv.className=&quot;alert alert-success&quot;;
            alertDiv.innerHTML=&apos;&lt;a href=&quot;#&quot; class=&quot;close&quot; data-dismiss=&quot;alert&quot; aria-label=&quot;close&quot;&gt;&amp;times;&lt;/a&gt;&apos;+ &quot;Peer has started viewing screen &quot;;        
            document.getElementById(&quot;alertBox&quot;).appendChild(alertDiv);

        }else if(type==&quot;screenshareError&quot;){

            var alertDiv = document.createElement(&quot;div&quot;);
            document.getElementById(&quot;alertBox&quot;).hidden=false;
            document.getElementById(&quot;alertBox&quot;).innerHTML=&quot;&quot;;
            alertDiv.className=&quot;alert alert-danger&quot;;
            alertDiv.innerHTML=&apos;&lt;a href=&quot;#&quot; class=&quot;close&quot; data-dismiss=&quot;alert&quot; aria-label=&quot;close&quot;&gt;&amp;times;&lt;/a&gt;&apos;+ &quot;There was a error while sharing screen , please contact support &quot;;
            document.getElementById(&quot;alertBox&quot;).appendChild(alertDiv);

        }else{
            // Handle these msgs too : TBD
        }

    }else{
        alert(message);
    }

}

function createExtensionInstallWindow (){
    try{
        var modalBox = document.createElement(&quot;div&quot;);
        modalBox.className = &quot;modal fade&quot;;
        modalBox.setAttribute(&quot;role&quot;, &quot;dialog&quot;);
        modalBox.id = &quot;screensharedialog&quot;;

        var modalinnerBox = document.createElement(&quot;div&quot;);
        modalinnerBox.className = &quot;modal-dialog&quot;;

        var modal = document.createElement(&quot;div&quot;);
        modal.className = &quot;modal-content&quot;;

        var modalheader = document.createElement(&quot;div&quot;);
        modalheader.className = &quot;modal-header&quot;;

        var closeButton = document.createElement(&quot;button&quot;);
        closeButton.className = &quot;close&quot;;
        closeButton.setAttribute(&quot;data-dismiss&quot;, &quot;modal&quot;);
        closeButton.innerHTML = &quot;&amp;times;&quot;;

        var title = document.createElement(&quot;h4&quot;);
        title.className = &quot;modal-title&quot;;
        title.innerHTML = &quot;Install extension&quot;;

        modalheader.appendChild(title);
        modalheader.appendChild(closeButton);


        var modalbody = document.createElement(&quot;div&quot;);
        modalbody.className = &quot;modal-body&quot;;

        var div = document.createElement(&quot;div&quot;);
        div.innerHTML = &quot;install screen share extension &quot;;

        var button = document.createElement(&quot;button&quot;);
        button.innerHTML = &quot; Install &quot;;
        button.onclick = function (e) {
            chrome.webstore.install(&quot;https://chrome.google.com/webstore/detail/&quot; + screenshareobj.extensionID,
                function () {
                    webrtcdev.log(&quot;Chrome extension inline installation - success from assignScreenInstallButton . Now  createOrAssignScreenshareButton with &quot;, screenshareobj);
                    window.location.reload();
                }, function (e) {
                    webrtcdev.error(&quot;Chrome extension inline installation - fail &quot;, e);
                });
            // Prevent the opening of the Web Store page
            e.preventDefault();
        };

        modalbody.appendChild(div);
        modalbody.appendChild(button);

        modal.appendChild(modalheader);
        modal.appendChild(modalbody);

        modalinnerBox.appendChild(modal);
        modalBox.appendChild(modalinnerBox);

        if(document.getElementById(&quot;mainDiv&quot;)){
            var mainDiv = document.getElementById(&quot;mainDiv&quot;);
            mainDiv.appendChild(modalBox);

            //document.getElementById(&quot;screensharedialog&quot;).showModal();
            $(&quot;#screensharedialog&quot;).modal(&quot;show&quot;);            
        }

    }catch(e){
        webrtcdev.error(&quot;[ createExtensionInstallWindow - Screenshare.js]&quot; , e); 
    }
                                
}</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../../">
  <title data-ice="title">src/codemirror/mode/textile/textile.js | webrtcdevelopment</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="webrtc based communication and collaboration client. Contains lot of experiments modules "><meta property="twitter:card" content="summary"><meta property="twitter:title" content="webrtcdevelopment"><meta property="twitter:description" content="webrtc based communication and collaboration client. Contains lot of experiments modules "></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/altanai/webrtc"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#scripts">scripts</a><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-CanvasRecorder">CanvasRecorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-GetRecorderType">GetRecorderType</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-GifRecorder">GifRecorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MRecordRTC">MRecordRTC</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MediaStreamRecorder">MediaStreamRecorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-RecordRTC">RecordRTC</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-RecordRTCConfiguration">RecordRTCConfiguration</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-StereoAudioRecorder">StereoAudioRecorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-Whammy">Whammy</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-WhammyRecorder">WhammyRecorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-createFileSharingDiv">createFileSharingDiv</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-_turn.js">_turn.js</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#scripts-rtcconn">scripts/rtcconn</a><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-Whammy">Whammy</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/codemirror/mode/textile/textile.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE

(function(mod) {
  if (typeof exports == &apos;object&apos; &amp;&amp; typeof module == &apos;object&apos;) { // CommonJS
    mod(require(&apos;../../lib/codemirror&apos;));
  } else if (typeof define == &apos;function&apos; &amp;&amp; define.amd) { // AMD
    define([&apos;../../lib/codemirror&apos;], mod);
  } else { // Plain browser env
    mod(CodeMirror);
  }
})(function(CodeMirror) {
&apos;use strict&apos;;

var TOKEN_STYLES = {
  addition: &apos;positive&apos;,
  attributes: &apos;attribute&apos;,
  bold: &apos;strong&apos;,
  cite: &apos;keyword&apos;,
  code: &apos;atom&apos;,
  definitionList: &apos;number&apos;,
  deletion: &apos;negative&apos;,
  div: &apos;punctuation&apos;,
  em: &apos;em&apos;,
  footnote: &apos;variable&apos;,
  footCite: &apos;qualifier&apos;,
  header: &apos;header&apos;,
  html: &apos;comment&apos;,
  image: &apos;string&apos;,
  italic: &apos;em&apos;,
  link: &apos;link&apos;,
  linkDefinition: &apos;link&apos;,
  list1: &apos;variable-2&apos;,
  list2: &apos;variable-3&apos;,
  list3: &apos;keyword&apos;,
  notextile: &apos;string-2&apos;,
  pre: &apos;operator&apos;,
  p: &apos;property&apos;,
  quote: &apos;bracket&apos;,
  span: &apos;quote&apos;,
  specialChar: &apos;tag&apos;,
  strong: &apos;strong&apos;,
  sub: &apos;builtin&apos;,
  sup: &apos;builtin&apos;,
  table: &apos;variable-3&apos;,
  tableHeading: &apos;operator&apos;
};

function Parser(regExpFactory, state, stream) {
  this.regExpFactory = regExpFactory;
  this.state = state;
  this.stream = stream;
  this.styles = TOKEN_STYLES;

  this.state.specialChar = null;
}

Parser.prototype.eat = function(name) {
  return this.stream.match(this.regExpFactory.pattern(name), true);
};

Parser.prototype.check = function(name) {
  return this.stream.match(this.regExpFactory.pattern(name), false);
};

Parser.prototype.setModeForNextToken = function(mode) {
  return this.state.mode = mode;
};

Parser.prototype.execMode = function(newMode) {
  return this.setModeForNextToken(newMode).call(this);
};

Parser.prototype.startNewLine = function() {
  this.setModeForNextToken(Modes.newLayout);
  this.state.tableHeading = false;

  if (this.state.layoutType === &apos;definitionList&apos; &amp;&amp; this.state.spanningLayout) {
    if (this.check(&apos;definitionListEnd&apos;)) {
      this.state.spanningLayout = false;
    }
  }
};

Parser.prototype.nextToken = function() {
  return this.state.mode.call(this);
};

Parser.prototype.styleFor = function(token) {
  if (this.styles.hasOwnProperty(token)) {
    return this.styles[token];
  }
  throw &apos;unknown token&apos;;
};

Parser.prototype.handlePhraseModifier = function(ch) {
  if (ch === &apos;_&apos;) {
    if (this.stream.eat(&apos;_&apos;)) {
      return this.togglePhraseModifier(&apos;italic&apos;, /^.*__/);
    }
    return this.togglePhraseModifier(&apos;em&apos;, /^.*_/);
  }

  if (ch === &apos;*&apos;) {
    if (this.stream.eat(&apos;*&apos;)) {
      return this.togglePhraseModifier(&apos;bold&apos;, /^.*\*\*/);
    }
    return this.togglePhraseModifier(&apos;strong&apos;, /^.*\*/);
  }

  if (ch === &apos;[&apos;) {
    if (this.stream.match(/\d+\]/)) {
      this.state.footCite = true;
    }
    return this.tokenStyles();
  }

  if (ch === &apos;(&apos;) {
    if (this.stream.match(&apos;r)&apos;)) {
      this.state.specialChar = &apos;r&apos;;
    } else if (this.stream.match(&apos;tm)&apos;)) {
      this.state.specialChar = &apos;tm&apos;;
    } else if (this.stream.match(&apos;c)&apos;)) {
      this.state.specialChar = &apos;c&apos;;
    }
    return this.tokenStyles();
  }

  if (ch === &apos;&lt;&apos;) {
    if (this.stream.match(/(\w+)[^&gt;]+&gt;[^&lt;]+&lt;\/\1&gt;/)) {
      return this.tokenStylesWith(this.styleFor(&apos;html&apos;));
    }
  }

  if (ch === &apos;?&apos; &amp;&amp; this.stream.eat(&apos;?&apos;)) {
    return this.togglePhraseModifier(&apos;cite&apos;, /^.*\?\?/);
  }
  if (ch === &apos;=&apos; &amp;&amp; this.stream.eat(&apos;=&apos;)) {
    return this.togglePhraseModifier(&apos;notextile&apos;, /^.*==/);
  }
  if (ch === &apos;-&apos;) {
    return this.togglePhraseModifier(&apos;deletion&apos;, /^.*-/);
  }
  if (ch === &apos;+&apos;) {
    return this.togglePhraseModifier(&apos;addition&apos;, /^.*\+/);
  }
  if (ch === &apos;~&apos;) {
    return this.togglePhraseModifier(&apos;sub&apos;, /^.*~/);
  }
  if (ch === &apos;^&apos;) {
    return this.togglePhraseModifier(&apos;sup&apos;, /^.*\^/);
  }
  if (ch === &apos;%&apos;) {
    return this.togglePhraseModifier(&apos;span&apos;, /^.*%/);
  }
  if (ch === &apos;@&apos;) {
    return this.togglePhraseModifier(&apos;code&apos;, /^.*@/);
  }
  if (ch === &apos;!&apos;) {
    var type = this.togglePhraseModifier(&apos;image&apos;, /^.*(?:\([^\)]+\))?!/);
    this.stream.match(/^:\S+/); // optional Url portion
    return type;
  }
  return this.tokenStyles();
};

Parser.prototype.togglePhraseModifier = function(phraseModifier, closeRE) {
  if (this.state[phraseModifier]) { // remove phrase modifier
    var type = this.tokenStyles();
    this.state[phraseModifier] = false;
    return type;
  }
  if (this.stream.match(closeRE, false)) { // add phrase modifier
    this.state[phraseModifier] = true;
    this.setModeForNextToken(Modes.attributes);
  }
  return this.tokenStyles();
};

Parser.prototype.tokenStyles = function() {
  var disabled = this.textileDisabled(),
      styles = [];

  if (disabled) return disabled;

  if (this.state.layoutType) {
    styles.push(this.styleFor(this.state.layoutType));
  }

  styles = styles.concat(this.activeStyles(&apos;addition&apos;, &apos;bold&apos;, &apos;cite&apos;, &apos;code&apos;,
      &apos;deletion&apos;, &apos;em&apos;, &apos;footCite&apos;, &apos;image&apos;, &apos;italic&apos;, &apos;link&apos;, &apos;span&apos;, &apos;specialChar&apos;, &apos;strong&apos;,
      &apos;sub&apos;, &apos;sup&apos;, &apos;table&apos;, &apos;tableHeading&apos;));

  if (this.state.layoutType === &apos;header&apos;) {
    styles.push(this.styleFor(&apos;header&apos;) + &apos;-&apos; + this.state.header);
  }
  return styles.length ? styles.join(&apos; &apos;) : null;
};

Parser.prototype.textileDisabled = function() {
  var type = this.state.layoutType;

  switch(type) {
    case &apos;notextile&apos;:
    case &apos;code&apos;:
    case &apos;pre&apos;:
      return this.styleFor(type);
    default:
      if (this.state.notextile) {
        return this.styleFor(&apos;notextile&apos;) + (type ? (&apos; &apos; + this.styleFor(type)) : &apos;&apos;);
      }

      return null;
  }
};

Parser.prototype.tokenStylesWith = function(extraStyles) {
  var disabled = this.textileDisabled(),
      type;

  if (disabled) return disabled;

  type = this.tokenStyles();
  if(extraStyles) {
    return type ? (type + &apos; &apos; + extraStyles) : extraStyles;
  }
  return type;
};

Parser.prototype.activeStyles = function() {
  var styles = [],
      i;
  for (i = 0; i &lt; arguments.length; ++i) {
    if (this.state[arguments[i]]) {
      styles.push(this.styleFor(arguments[i]));
    }
  }
  return styles;
};

Parser.prototype.blankLine = function() {
  var spanningLayout = this.state.spanningLayout,
      type = this.state.layoutType,
      key;

  for (key in this.state) {
    if (this.state.hasOwnProperty(key)) {
      delete this.state[key];
    }
  }

  this.setModeForNextToken(Modes.newLayout);
  if (spanningLayout) {
    this.state.layoutType = type;
    this.state.spanningLayout = true;
  }
};


function RegExpFactory() {
  this.cache = {};
  this.single = {
    bc: &apos;bc&apos;,
    bq: &apos;bq&apos;,
    definitionList: /- [^(?::=)]+:=+/,
    definitionListEnd: /.*=:\s*$/,
    div: &apos;div&apos;,
    drawTable: /\|.*\|/,
    foot: /fn\d+/,
    header: /h[1-6]/,
    html: /\s*&lt;(?:\/)?(\w+)(?:[^&gt;]+)?&gt;(?:[^&lt;]+&lt;\/\1&gt;)?/,
    link: /[^&quot;]+&quot;:\S/,
    linkDefinition: /\[[^\s\]]+\]\S+/,
    list: /(?:#+|\*+)/,
    notextile: &apos;notextile&apos;,
    para: &apos;p&apos;,
    pre: &apos;pre&apos;,
    table: &apos;table&apos;,
    tableCellAttributes: /[/\\]\d+/,
    tableHeading: /\|_\./,
    tableText: /[^&quot;_\*\[\(\?\+~\^%@|-]+/,
    text: /[^!&quot;_=\*\[\(&lt;\?\+~\^%@-]+/
  };
  this.attributes = {
    align: /(?:&lt;&gt;|&lt;|&gt;|=)/,
    selector: /\([^\(][^\)]+\)/,
    lang: /\[[^\[\]]+\]/,
    pad: /(?:\(+|\)+){1,2}/,
    css: /\{[^\}]+\}/
  };
}

RegExpFactory.prototype.pattern = function(name) {
  return (this.cache[name] || this.createRe(name));
};

RegExpFactory.prototype.createRe = function(name) {
  switch (name) {
    case &apos;drawTable&apos;:
      return this.makeRe(&apos;^&apos;, this.single.drawTable, &apos;$&apos;);
    case &apos;html&apos;:
      return this.makeRe(&apos;^&apos;, this.single.html, &apos;(?:&apos;, this.single.html, &apos;)*&apos;, &apos;$&apos;);
    case &apos;linkDefinition&apos;:
      return this.makeRe(&apos;^&apos;, this.single.linkDefinition, &apos;$&apos;);
    case &apos;listLayout&apos;:
      return this.makeRe(&apos;^&apos;, this.single.list, this.pattern(&apos;allAttributes&apos;), &apos;*\\s+&apos;);
    case &apos;tableCellAttributes&apos;:
      return this.makeRe(&apos;^&apos;, this.choiceRe(this.single.tableCellAttributes,
          this.pattern(&apos;allAttributes&apos;)), &apos;+\\.&apos;);
    case &apos;type&apos;:
      return this.makeRe(&apos;^&apos;, this.pattern(&apos;allTypes&apos;));
    case &apos;typeLayout&apos;:
      return this.makeRe(&apos;^&apos;, this.pattern(&apos;allTypes&apos;), this.pattern(&apos;allAttributes&apos;),
          &apos;*\\.\\.?&apos;, &apos;(\\s+|$)&apos;);
    case &apos;attributes&apos;:
      return this.makeRe(&apos;^&apos;, this.pattern(&apos;allAttributes&apos;), &apos;+&apos;);

    case &apos;allTypes&apos;:
      return this.choiceRe(this.single.div, this.single.foot,
          this.single.header, this.single.bc, this.single.bq,
          this.single.notextile, this.single.pre, this.single.table,
          this.single.para);

    case &apos;allAttributes&apos;:
      return this.choiceRe(this.attributes.selector, this.attributes.css,
          this.attributes.lang, this.attributes.align, this.attributes.pad);

    default:
      return this.makeRe(&apos;^&apos;, this.single[name]);
  }
};


RegExpFactory.prototype.makeRe = function() {
  var pattern = &apos;&apos;,
      i,
      arg;

  for (i = 0; i &lt; arguments.length; ++i) {
    arg = arguments[i];
    pattern += (typeof arg === &apos;string&apos;) ? arg : arg.source;
  }
  return new RegExp(pattern);
};

RegExpFactory.prototype.choiceRe = function() {
  var parts = [arguments[0]],
      i;

  for (i = 1; i &lt; arguments.length; ++i) {
    parts[i * 2 - 1] = &apos;|&apos;;
    parts[i * 2] = arguments[i];
  }

  parts.unshift(&apos;(?:&apos;);
  parts.push(&apos;)&apos;);
  return this.makeRe.apply(this, parts);
};


var Modes = {
  newLayout: function() {
    if (this.check(&apos;typeLayout&apos;)) {
      this.state.spanningLayout = false;
      return this.execMode(Modes.blockType);
    }
    if (!this.textileDisabled()) {
      if (this.check(&apos;listLayout&apos;)) {
        return this.execMode(Modes.list);
      } else if (this.check(&apos;drawTable&apos;)) {
        return this.execMode(Modes.table);
      } else if (this.check(&apos;linkDefinition&apos;)) {
        return this.execMode(Modes.linkDefinition);
      } else if (this.check(&apos;definitionList&apos;)) {
        return this.execMode(Modes.definitionList);
      } else if (this.check(&apos;html&apos;)) {
        return this.execMode(Modes.html);
      }
    }
    return this.execMode(Modes.text);
  },

  blockType: function() {
    var match,
        type;
    this.state.layoutType = null;

    if (match = this.eat(&apos;type&apos;)) {
      type = match[0];
    } else {
      return this.execMode(Modes.text);
    }

    if(match = type.match(this.regExpFactory.pattern(&apos;header&apos;))) {
      this.state.layoutType = &apos;header&apos;;
      this.state.header = parseInt(match[0][1]);
    } else if (type.match(this.regExpFactory.pattern(&apos;bq&apos;))) {
      this.state.layoutType = &apos;quote&apos;;
    } else if (type.match(this.regExpFactory.pattern(&apos;bc&apos;))) {
      this.state.layoutType = &apos;code&apos;;
    } else if (type.match(this.regExpFactory.pattern(&apos;foot&apos;))) {
      this.state.layoutType = &apos;footnote&apos;;
    } else if (type.match(this.regExpFactory.pattern(&apos;notextile&apos;))) {
      this.state.layoutType = &apos;notextile&apos;;
    } else if (type.match(this.regExpFactory.pattern(&apos;pre&apos;))) {
      this.state.layoutType = &apos;pre&apos;;
    } else if (type.match(this.regExpFactory.pattern(&apos;div&apos;))) {
      this.state.layoutType = &apos;div&apos;;
    } else if (type.match(this.regExpFactory.pattern(&apos;table&apos;))) {
      this.state.layoutType = &apos;table&apos;;
    }

    this.setModeForNextToken(Modes.attributes);
    return this.tokenStyles();
  },

  text: function() {
    if (this.eat(&apos;text&apos;)) {
      return this.tokenStyles();
    }

    var ch = this.stream.next();

    if (ch === &apos;&quot;&apos;) {
      return this.execMode(Modes.link);
    }
    return this.handlePhraseModifier(ch);
  },

  attributes: function() {
    this.setModeForNextToken(Modes.layoutLength);

    if (this.eat(&apos;attributes&apos;)) {
      return this.tokenStylesWith(this.styleFor(&apos;attributes&apos;));
    }
    return this.tokenStyles();
  },

  layoutLength: function() {
    if (this.stream.eat(&apos;.&apos;) &amp;&amp; this.stream.eat(&apos;.&apos;)) {
      this.state.spanningLayout = true;
    }

    this.setModeForNextToken(Modes.text);
    return this.tokenStyles();
  },

  list: function() {
    var match = this.eat(&apos;list&apos;),
        listMod;
    this.state.listDepth = match[0].length;
    listMod = (this.state.listDepth - 1) % 3;
    if (!listMod) {
      this.state.layoutType = &apos;list1&apos;;
    } else if (listMod === 1) {
      this.state.layoutType = &apos;list2&apos;;
    } else {
      this.state.layoutType = &apos;list3&apos;;
    }
    this.setModeForNextToken(Modes.attributes);
    return this.tokenStyles();
  },

  link: function() {
    this.setModeForNextToken(Modes.text);
    if (this.eat(&apos;link&apos;)) {
      this.stream.match(/\S+/);
      return this.tokenStylesWith(this.styleFor(&apos;link&apos;));
    }
    return this.tokenStyles();
  },

  linkDefinition: function() {
    this.stream.skipToEnd();
    return this.tokenStylesWith(this.styleFor(&apos;linkDefinition&apos;));
  },

  definitionList: function() {
    this.eat(&apos;definitionList&apos;);

    this.state.layoutType = &apos;definitionList&apos;;

    if (this.stream.match(/\s*$/)) {
      this.state.spanningLayout = true;
    } else {
      this.setModeForNextToken(Modes.attributes);
    }
    return this.tokenStyles();
  },

  html: function() {
    this.stream.skipToEnd();
    return this.tokenStylesWith(this.styleFor(&apos;html&apos;));
  },

  table: function() {
    this.state.layoutType = &apos;table&apos;;
    return this.execMode(Modes.tableCell);
  },

  tableCell: function() {
    if (this.eat(&apos;tableHeading&apos;)) {
      this.state.tableHeading = true;
    } else {
      this.stream.eat(&apos;|&apos;);
    }
    this.setModeForNextToken(Modes.tableCellAttributes);
    return this.tokenStyles();
  },

  tableCellAttributes: function() {
    this.setModeForNextToken(Modes.tableText);

    if (this.eat(&apos;tableCellAttributes&apos;)) {
      return this.tokenStylesWith(this.styleFor(&apos;attributes&apos;));
    }
    return this.tokenStyles();
  },

  tableText: function() {
    if (this.eat(&apos;tableText&apos;)) {
      return this.tokenStyles();
    }

    if (this.stream.peek() === &apos;|&apos;) { // end of cell
      this.setModeForNextToken(Modes.tableCell);
      return this.tokenStyles();
    }
    return this.handlePhraseModifier(this.stream.next());
  }
};


CodeMirror.defineMode(&apos;textile&apos;, function() {
  var regExpFactory = new RegExpFactory();

  return {
    startState: function() {
      return { mode: Modes.newLayout };
    },
    token: function(stream, state) {
      var parser = new Parser(regExpFactory, state, stream);
      if (stream.sol()) { parser.startNewLine(); }
      return parser.nextToken();
    },
    blankLine: function(state) {
      new Parser(regExpFactory, state).blankLine();
    }
  };
});

CodeMirror.defineMIME(&apos;text/x-textile&apos;, &apos;textile&apos;);
});
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>

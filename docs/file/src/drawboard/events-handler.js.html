<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/drawboard/events-handler.js | webrtcdevelopment</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="webrtc based communication and collaboration client. Contains lot of experiments modules "><meta property="twitter:card" content="summary"><meta property="twitter:title" content="webrtcdevelopment"><meta property="twitter:description" content="webrtc based communication and collaboration client. Contains lot of experiments modules "></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/altanai/webrtc"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#scripts">scripts</a><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-CanvasRecorder">CanvasRecorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-GetRecorderType">GetRecorderType</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-GifRecorder">GifRecorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MRecordRTC">MRecordRTC</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MediaStreamRecorder">MediaStreamRecorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-RecordRTC">RecordRTC</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-RecordRTCConfiguration">RecordRTCConfiguration</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-StereoAudioRecorder">StereoAudioRecorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-Whammy">Whammy</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-WhammyRecorder">WhammyRecorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-createFileSharingDiv">createFileSharingDiv</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-_turn.js">_turn.js</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#scripts-rtcconn">scripts/rtcconn</a><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-Whammy">Whammy</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/drawboard/events-handler.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/* ***********************************************
Events handler 
*********************************************/

var selfId = parent.selfuserid;

var isTouch = &apos;createTouch&apos; in document;

addEvent(canvas, isTouch ? &apos;touchstart&apos; : &apos;mousedown&apos;, function (e) {
    if (isTouch) e = e.pageX ? e : e.touches.length ? e.touches[0] : { pageX: 0, pageY: 0 };

    var cache = is;

    console.log(&quot; canvas coordinates x -&gt;&quot; , e.pageX , &quot;||&quot;, canvas.offsetLeft);
    console.log(&quot; canvas coordinates y -&gt;&quot; , e.pageY ,&quot; ||&quot;, canvas.offsetTop);

    if (cache.isLine){
 lineHandler.mousedown(e);
}
    else if (cache.isArc) {
arcHandler.mousedown(e);
}
    else if (cache.isRectangle){
 rectHandler.mousedown(e);
}
    else if (cache.isQuadraticCurve){
 quadraticHandler.mousedown(e);
}
    else if (cache.isBezierCurve){
 bezierHandler.mousedown(e);
}
    else if (cache.isDragLastPath || cache.isDragAllPaths){
 dragHelper.mousedown(e);
}
    else if (is.isPencil){
pencilHandler.mousedown(e);
}
    else if (is.isEraser){
 eraserHandler.mousedown(e);
}
    else if (is.isText){
 textHandler.mousedown(e);
}
else{
console.log(&quot; none of the event matched &quot;);
return;
}   
    drawHelper.redraw();
});


addEvent(canvas, isTouch ? &apos;touchend&apos; : &apos;mouseup&apos;, function (e) {
    if (isTouch) e = e.pageX ? e : e.touches.length ? e.touches[0] : { pageX: 0, pageY: 0 };
    
    var cache = is;

    if (cache.isLine) lineHandler.mouseup(e);
    else if (cache.isArc) arcHandler.mouseup(e);
    else if (cache.isRectangle) rectHandler.mouseup(e);
    else if (cache.isQuadraticCurve) quadraticHandler.mouseup(e);
    else if (cache.isBezierCurve) bezierHandler.mouseup(e);
    else if (cache.isDragLastPath || cache.isDragAllPaths) dragHelper.mouseup(e);
    else if (is.isPencil) pencilHandler.mouseup(e);
    else if (is.isEraser) eraserHandler.mouseup(e);
    else if (is.isText) textHandler.mouseup(e);

    drawHelper.redraw();
});


addEvent(canvas, isTouch ? &apos;touchmove&apos; : &apos;mousemove&apos;, function (e) {
    if (isTouch) e = e.pageX ? e : e.touches.length ? e.touches[0] : { pageX: 0, pageY: 0 };
    
    var cache = is;

    if (cache.isLine) lineHandler.mousemove(e);
    else if (cache.isArc) arcHandler.mousemove(e);
    else if (cache.isRectangle) rectHandler.mousemove(e);
    else if (cache.isQuadraticCurve) quadraticHandler.mousemove(e);
    else if (cache.isBezierCurve) bezierHandler.mousemove(e);
    else if (cache.isDragLastPath || cache.isDragAllPaths) dragHelper.mousemove(e);
    else if (is.isPencil) pencilHandler.mousemove(e);
    else if (is.isEraser) eraserHandler.mousemove(e);
    else if (is.isText) textHandler.mousemove(e);
});



var keyCode;



function onkeydown(e) {
    keyCode = e.keyCode;

    if (!isControlKeyPressed &amp;&amp; keyCode === 17) {
        isControlKeyPressed = true;
    }
}

addEvent(document, &apos;keydown&apos;, onkeydown);



function onkeyup(e) {
    keyCode = e.keyCode;

    /*-------------------------- Ctrl + Z --------------------------*/
    
    if (isControlKeyPressed &amp;&amp; keyCode === 90) {
        if (points.length) {
            points.length = points.length - 1;
            drawHelper.redraw();
        }
    }

    /*-------------------------- Ctrl + A --------------------------*/

    if (isControlKeyPressed &amp;&amp; keyCode === 65) {
        dragHelper.global.startingIndex = 0;

        endLastPath();
        
        setSelection(find(&apos;drag-all-paths&apos;), &apos;DragAllPaths&apos;);
    }

    /*-------------------------- Ctrl + C --------------------------*/
    
    if (isControlKeyPressed &amp;&amp; keyCode === 67 &amp;&amp; points.length) {
        copy();
    }

    /*-------------------------- Ctrl + V --------------------------*/
    if (isControlKeyPressed &amp;&amp; keyCode === 86 &amp;&amp; copiedStuff.length) {
        paste();
    }

    /*-------------------------- Ending the Control Key --------------------------*/
    
    if (keyCode === 17) {
        isControlKeyPressed = false;
    }
}

addEvent(document, &apos;keyup&apos;, onkeyup);


var lastPoint = [];

window.addEventListener(&apos;message&apos;, function(event) {

    console.log(&quot; window message&quot; , event);

    if (!event.data || !event.data.canvasDesignerSyncData) return;

    if (event.data.sender &amp;&amp; event.data.sender == selfId) return;

    // drawing is shared here (array of points)
    points = event.data.canvasDesignerSyncData;

    // to support two-way sharing
    if (!lastPoint.length) {
        lastPoint = points.join(&apos;&apos;);
    }
    drawHelper.redraw(true);
}, false);

function syncPoints() {

    if (!lastPoint.length) {
        lastPoint = points.join(&apos;&apos;);
    }
    
    if (points.join(&apos;&apos;) != lastPoint) {
        syncData(points || []);
        lastPoint = points.join(&apos;&apos;);
    }
}

function syncData(data) {
    parent.postMessage({
        canvasDesignerSyncData: data,
        sender: selfId
    }, &apos;*&apos;);
}


// parent post message is wokring 
// test this by 
// window.frames[0].parent.postMessage(&quot;hi&quot;, &apos;*&apos;)</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
